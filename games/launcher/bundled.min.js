/*
Copyright(c) 2012 Company Name
*/
Ext.define("BigBrainzLauncher.view.SchoolSelectionWindow",{extend:"Ext.window.Window",height:362,hidden:false,id:"school_selection_window",width:400,layout:{type:"fit"},title:"Select Your School",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",layout:{type:"accordion"},title:"",titleCollapse:true,items:[{xtype:"panel",id:"selectCountry",layout:{align:"stretch",type:"vbox"},collapsed:false,collapsible:true,title:"Select Your Country",items:[{xtype:"combobox",id:"comboCountry",displayField:"name",forceSelection:true,queryMode:"local",store:"CountryStore",valueField:"id",listeners:{select:{fn:a.onComboCountrySelect,scope:a}}}],listeners:{expand:{fn:a.onSelectCountryExpand,scope:a}}},{xtype:"panel",disabled:true,id:"selectState",layout:{align:"stretch",type:"vbox"},collapsed:true,collapsible:true,title:"Select Your State",items:[{xtype:"combobox",id:"comboState",fieldLabel:"",displayField:"name",forceSelection:true,queryMode:"local",store:"StateStore",valueField:"id",listeners:{select:{fn:a.onComboStateSelect,scope:a}}}],listeners:{expand:{fn:a.onSelectStateExpand,scope:a}}},{xtype:"panel",disabled:true,id:"selectDistrict",layout:{align:"stretch",type:"vbox"},collapsed:true,collapsible:true,title:"Select Your District",listeners:{expand:{fn:a.onSelectDistrictExpand,scope:a},collapse:{fn:a.onSelectDistrictCollapse,scope:a}},items:[{xtype:"container",id:"district_select_container",layout:{type:"fit"},items:[{xtype:"combobox",id:"comboDistrict",fieldLabel:"",displayField:"name",forceSelection:true,queryMode:"local",store:"DistrictStore",valueField:"id",listeners:{select:{fn:a.onComboDistrictSelect,scope:a}}}]}]},{xtype:"panel",disabled:true,id:"selectSchool",layout:{align:"stretch",type:"vbox"},collapsed:true,collapsible:true,title:"Select Your School",items:[{xtype:"combobox",id:"comboSchool",fieldLabel:"",displayField:"name",forceSelection:true,queryMode:"local",store:"SchoolStore",valueField:"id",listeners:{select:{fn:a.onComboSchoolSelect,scope:a}}}],listeners:{expand:{fn:a.onSelectSchoolExpand,scope:a},collapse:{fn:a.onSelectSchoolCollapse,scope:a}}},{xtype:"panel",id:"school_login_panel",collapsed:true,collapsible:true,title:"",items:[{xtype:"container",height:198,id:"school_with_password",layout:{align:"center",type:"vbox"},items:[{xtype:"container",flex:1},{xtype:"textfield",validator:function(b){return(b.length>=1)?true:false},height:30,id:"school_password",padding:"",width:300,fieldLabel:"Password",labelWidth:60,inputType:"password",minLength:1,minLengthText:"You must enter in a password."},{xtype:"button",handler:function(b,c){},height:30,id:"login_btn",padding:"",width:100,text:"Login",listeners:{click:{fn:a.onLogin_btnClick,scope:a}}},{xtype:"container",padding:"10 0 0 0",width:400,items:[{xtype:"container",height:20,layout:{align:"center",type:"vbox"},items:[{xtype:"label",flex:1,height:14,style:"{text-align:center;}",text:"Please enter a teacher or student password."}]},{xtype:"container",height:20,layout:{align:"center",type:"vbox"},items:[{xtype:"label",flex:1,style:"{\ntext-align:center;\ncolor:blue;\n}",text:"If you don't know your password, click here.",listeners:{afterrender:{fn:a.onLabelAfterRender,scope:a}}}]}]},{xtype:"container",flex:1}],listeners:{afterlayout:{fn:a.onSchool_with_passwordAfterLayout,scope:a},afterrender:{fn:a.onSchool_with_passwordAfterRender,scope:a}}},{xtype:"container",hidden:true,id:"school_without_password",layout:{align:"middle",type:"hbox"},items:[{xtype:"container",flex:1,layout:{type:"hbox"},items:[{xtype:"container",flex:1,height:50,layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"button",handler:function(c,d){var b=Ext.create("BigBrainzLauncher.view.BigBrainzSetup");b.show()},flex:1,id:"educator_without_password",text:"Educator"}]},{xtype:"container",flex:1,height:50,layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"button",handler:function(b,c){Ext.MessageBox.alert("Big Brainz","Please contact your school and ask them to set a schoolwide password.  When a password is set, then you will be able to play.")},flex:1,id:"student_without_password",text:"Student"}]}]}]}]}]}],listeners:{afterrender:{fn:a.onSchool_selection_windowAfterRender,scope:a}}});a.callParent(arguments)},onComboCountrySelect:function(e,b,c){setTimeout(function(){Ext.getCmp("selectState").enable();Ext.getCmp("selectCountry").collapse()},250);var a=new Date();var d=new Date(a.getFullYear()+1,a.getMonth(),a.getDate());Ext.util.Cookies.set("__country_id_saved",b[0].data.id,d);Ext.util.Cookies.set("__country_name_saved",b[0].data.name,d);this.country_id=b[0].data.id;this.country_name=b[0].data.name;Ext.getCmp("selectCountry").setTitle(b[0].data.name)},onSelectCountryExpand:function(c,a){Ext.getCmp("selectCountry").setTitle("Select Your Country");Ext.getCmp("selectState").setTitle("Select Your State");Ext.getCmp("selectDistrict").setTitle("Select Your District");Ext.getCmp("selectSchool").setTitle("Select Your School");Ext.getCmp("selectState").disable();Ext.getCmp("selectDistrict").disable();Ext.getCmp("selectSchool").disable();Ext.getCmp("school_login_panel").hide();Ext.getCmp("school_with_password").hide();Ext.getCmp("school_without_password").hide();Ext.util.Cookies.clear("__country_id_saved");Ext.util.Cookies.clear("__country_name_saved");Ext.util.Cookies.clear("__state_id_saved");Ext.util.Cookies.clear("__state_name_saved");Ext.util.Cookies.clear("__district_id_saved");Ext.util.Cookies.clear("__district_name_saved");Ext.util.Cookies.clear("__school_id_saved");Ext.util.Cookies.clear("__school_name_saved");try{var d=Ext.state.LocalStorageProvider.create();d.clear("school_id");d.clear("school_name");d.clear("district_id");d.clear("district_name");d.clear("state_id");d.clear("state_name");d.clear("country_id");d.clear("country_name")}catch(b){}Ext.getCmp("comboState").getStore().clearFilter()},onComboStateSelect:function(e,b,c){var a=new Date();var d=new Date(a.getFullYear()+1,a.getMonth(),a.getDate());Ext.util.Cookies.set("__state_id_saved",b[0].data.id,d);Ext.util.Cookies.set("__state_name_saved",b[0].data.name,d);this.state_id=b[0].data.id;this.state_name=b[0].data.name;Ext.getCmp("selectState").setTitle(b[0].data.name);setTimeout(function(){Ext.getCmp("selectDistrict").enable();Ext.getCmp("selectState").collapse()},250)},onSelectStateExpand:function(b,a){Ext.getCmp("selectState").setTitle("Select Your State");Ext.getCmp("selectDistrict").setTitle("Select Your District");Ext.getCmp("selectSchool").setTitle("Select Your School");Ext.getCmp("selectDistrict").disable();Ext.getCmp("selectSchool").disable();Ext.getCmp("school_login_panel").hide();Ext.getCmp("school_with_password").hide();Ext.getCmp("school_without_password").hide();Ext.util.Cookies.clear("__state_id_saved");Ext.util.Cookies.clear("__state_name_saved");Ext.util.Cookies.clear("__district_id_saved");Ext.util.Cookies.clear("__district_name_saved");Ext.util.Cookies.clear("__school_id_saved");Ext.util.Cookies.clear("__school_name_saved");Ext.getStore("StateStore").proxy.url="routes/routes.php?url=/countries/"+this.country_id+"/children";Ext.getCmp("comboState").expand();Ext.getCmp("comboState").focus();setTimeout(function(){Ext.getStore("StateStore").load({callback:function(d,c,e){Ext.getCmp("comboDistrict").setValue("")}})},250)},onSelectDistrictExpand:function(c,a){Ext.getCmp("selectDistrict").setTitle("Select Your District");Ext.getCmp("selectSchool").setTitle("Select Your School");Ext.util.Cookies.clear("__district_id_saved");Ext.util.Cookies.clear("__district_name_saved");Ext.util.Cookies.clear("__school_id_saved");Ext.util.Cookies.clear("__school_name_saved");try{var d=Ext.state.LocalStorageProvider.create();d.clear("district_id");d.clear("district_name");d.clear("school_id");d.clear("school_name")}catch(b){}Ext.getStore("DistrictStore").proxy.url="routes/routes.php?url=/states/"+this.state_id+"/children";Ext.getCmp("comboDistrict").expand();Ext.getCmp("comboDistrict").focus();setTimeout(function(){Ext.getStore("DistrictStore").load({callback:function(f,e,g){Ext.getCmp("comboSchool").setValue("")}})},250)},onSelectDistrictCollapse:function(b,a){Ext.getCmp("comboDistrict").setValue();Ext.getStore("DistrictStore").clearFilter();Ext.getStore("DistrictStore").clearData()},onComboDistrictSelect:function(f,b,c){setTimeout(function(){Ext.getCmp("selectSchool").enable();Ext.getCmp("selectDistrict").collapse()},250);var a=new Date();var d=new Date(a.getFullYear()+1,a.getMonth(),a.getDate());Ext.util.Cookies.set("__district_id_saved",b[0].data.id,d);Ext.util.Cookies.set("__district_name_saved",b[0].data.name,d);this.district_id=b[0].data.id;this.district_name=b[0].data.name;district_data.id=this.district_id;district_data.name=this.district_name;if(b[0].data.UseLogin){Ext.getCmp("school_selection_window").hide();var e=Ext.create("BigBrainzLauncher.view.LoginWindow");e.show();return}Ext.getCmp("selectDistrict").setTitle(b[0].data.name)},onComboSchoolSelect:function(e,b,c){if(b[0].data.name=="District Overview"){var f=Ext.MessageBox.prompt("District Password","Please enter your district password.  If you don't know it, please call Big Brainz:",function(h,g){if(h=="ok"){Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/login/district&method=post",params:{id:district_data.id,password:g},success:function(k){var l=Ext.decode(k.responseText);if(l.success){Ext.getCmp("school_selection_window").destroy();Ext.create("BigBrainzLauncher.view.DistrictOverview")}else{Ext.Msg.alert("Incorrect Password",l.message);Ext.getCmp("comboSchool").setValue("")}},failure:function(){Ext.Msg.alert("Could not log in.  Please try again.");Ext.getCmp("comboSchool").setValue("")}})}else{Ext.getCmp("comboSchool").setValue("")}});f.textField.inputEl.dom.type="password";return}var a=new Date();var d=new Date(a.getFullYear()+1,a.getMonth(),a.getDate());Ext.util.Cookies.set("__school_id_saved",b[0].data.id,d);this.school_id=b[0].data.id;Ext.util.Cookies.set("__school_name_saved",b[0].data.name,d);Ext.getStore("ClassStore").proxy.url="routes/routes.php?url=/schools/"+b[0].data.id+"/children";Ext.getStore("ClassStore").load();Ext.getStore("SchoolStore").proxy.url="routes/routes.php?url=/schools/"+b[0].data.id+"/login_info";Ext.getStore("SchoolStore").load({callback:function(k,h,l){var g=Ext.getStore("SchoolStore").data.items[0];Ext.getCmp("school_login_panel").expand();Ext.getCmp("school_login_panel").expand();Ext.getCmp("school_login_panel").show();if(g.data.HasPassword){setTimeout(function(){Ext.getCmp("school_with_password").show();Ext.getCmp("school_without_password").hide()},250)}else{setTimeout(function(){Ext.getCmp("school_without_password").show();Ext.getCmp("school_with_password").hide()},250)}Ext.getCmp("selectSchool").setTitle(g.data.name)}})},onSelectSchoolExpand:function(c,a){Ext.getCmp("selectSchool").setTitle("Select Your School");Ext.getCmp("school_login_panel").hide();Ext.getCmp("school_with_password").hide();Ext.getCmp("school_without_password").hide();Ext.util.Cookies.clear("__school_id_saved");Ext.util.Cookies.clear("__school_name_saved");Ext.getCmp("comboSchool").setValue("");try{var d=Ext.state.LocalStorageProvider.create();d.clear("school_id");d.clear("school_name")}catch(b){}Ext.getStore("SchoolStore").proxy.url="routes/routes.php?url=/districts/"+this.district_id+"/children";Ext.getCmp("comboSchool").expand();Ext.getCmp("comboSchool").focus();setTimeout(function(){Ext.getStore("SchoolStore").load({callback:function(f,e,g){}})},250)},onSelectSchoolCollapse:function(b,a){Ext.getCmp("comboSchool").setValue();Ext.getStore("SchoolStore").clearFilter()},onLogin_btnClick:function(c,d,b){if(!LoginAttempt.active){if(!Ext.getCmp("school_password").validate()){Ext.Msg.alert("Please enter in a password.");return}LoginAttempt.active=true;var a=Ext.getCmp("school_password").value;school_data.id=this.school_id;school_data.name=this.school_name;Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/login&method=post",params:{id:school_data.id,password:a},success:function(e){var g=Ext.decode(e.responseText);if(g.success){if(Ext.getCmp("school_selection_window")===undefined){}else{Ext.getCmp("school_selection_window").destroy()}if(g.access=="educator"){var h=Ext.create("BigBrainzLauncher.view.EducatorTreeViewport")}else{Ext.define("StudentPassword",{singleton:true,password:a});var f=Ext.create("BigBrainzLauncher.view.StudentViewport")}}else{Ext.Msg.alert(g.errors.reason)}LoginAttempt.active=false},failure:function(){LoginAttempt.active=false;Ext.Msg.alert("Could not log in.  Please try again.")}})}},onLabelAfterRender:function(a,b){a.getEl().on({click:function(c){var d=Ext.create("BigBrainzLauncher.view.StudentNeedPassword");d.show()},scope:a})},onSchool_with_passwordAfterLayout:function(a,c,b){Ext.getCmp("school_password").focus();Ext.getCmp("school_password").on("specialkey",function(d,f){if(f.keyCode==f.ENTER){Ext.getCmp("login_btn").fireEvent("click",{})}})},onSchool_with_passwordAfterRender:function(a,b){Ext.define("LoginAttempt",{singleton:true,active:false});try{var c=Ext.urlDecode(document.URL.split("?")[1]);school_pass=c.school_pass;if(school_pass!==""&&school_pass!==undefined){Ext.getCmp("school_password").setValue(school_pass);Ext.getCmp("login_btn").fireEvent("click",{})}}catch(d){}},onSchool_selection_windowAfterRender:function(a,b){this.initialize();if(Ext.util.Cookies.get("__district_overview")=="true"){this.load_district_overview();return}this.load_region_data_from_url();this.load_region_data_from_cookies();if(this.is_defined(this.school_id)&&this.district_id!="BB02691691445231259433720081208183020372969"){this.load_school_login()}else{if(this.is_defined(this.district_id)){this.load_district_login()}else{this.display_default()}}},initialize:function(){Ext.define("country_data",{singleton:true,id:"",name:""});Ext.define("state_data",{singleton:true,id:"",name:""});Ext.define("district_data",{singleton:true,id:"",name:""});Ext.define("school_data",{singleton:true,id:"",name:""});Ext.define("class_data",{singleton:true,id:"",name:""});Ext.define("student_data",{singleton:true,id:"",name:"",username:""});Ext.define("Ext.chart.theme.Fancy",{extend:"Ext.chart.theme.Base",constructor:function(a){this.callParent([Ext.apply({colors:["#66CC00","#0066cc","#FFFF00","#FF0000"]},a)])}});String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1};this.school_id="";this.district_id="";this.state_id="";this.country_id="";this.school_name="";this.district_name="";this.state_name="";this.country_name="";Ext.define("Ext.chart.theme.FluencyTimeGraph",{extend:"Ext.chart.theme.Base",constructor:function(a){this.callParent([Ext.apply({colors:["#0000ff","#4169E1","#1E90FF","#00BFFF"]},a)])}});Ext.define("Ext.chart.theme.ImprovementChart",{extend:"Ext.chart.theme.Base",constructor:function(a){this.callParent([Ext.apply({colors:["#FF0000","#0066cc"]},a)])}})},load_district_overview:function(){if(Ext.getCmp("school_selection_window")){Ext.getCmp("school_selection_window").hide()}district_data.id=Ext.util.Cookies.get("__district_id_saved");district_data.name=Ext.util.Cookies.get("__district_name_saved");Ext.util.Cookies.clear("__district_overview");Ext.create("BigBrainzLauncher.view.DistrictOverview")},load_region_data_from_url:function(){if(document.URL.split("?").length<2){return}try{var a=Ext.urlDecode(document.URL.split("?")[1]);this.school_id=a.school_id;this.district_id=a.district_id;this.state_id=a.state_id;this.country_id=a.country_id;this.school_name=a.school_name;this.district_name=a.district_name;this.state_name=a.state_name;this.country_name=a.country_name}catch(b){}},load_region_data_from_cookies:function(){if(!this.is_defined(this.school_id)){this.school_id=Ext.util.Cookies.get("__school_id_saved");this.school_name=Ext.util.Cookies.get("__school_name_saved")}if(!this.is_defined(this.district_id)){this.district_id=Ext.util.Cookies.get("__district_id_saved");this.district_name=Ext.util.Cookies.get("__district_name_saved")}if(!this.is_defined(this.state_id)){this.state_id=Ext.util.Cookies.get("__state_id_saved");this.state_name=Ext.util.Cookies.get("__state_name_saved")}if(!this.is_defined(this.country_id)){this.country_id=Ext.util.Cookies.get("__country_id_saved");this.country_name=Ext.util.Cookies.get("__country_name_saved")}},load_singleton_data:function(){school_data.id=this.school_id;school_data.name=this.school_name;district_data.id=this.district_id;district_data.name=this.district_name;state_data.id=this.state_id;state_data.name=this.state_name;country_data.id=this.country_id;country_data.name=this.country_name},is_defined:function(a){return(a!==""&&a!==null&&a!==undefined)},load_school_login:function(){Ext.getCmp("selectSchool").setTitle(this.school_name);Ext.getCmp("selectDistrict").setTitle(this.district_name);Ext.getCmp("selectState").setTitle(this.state_name);Ext.getCmp("selectCountry").setTitle(this.country_name);Ext.getCmp("selectCountry").enable();Ext.getCmp("selectState").enable();Ext.getCmp("selectDistrict").enable();Ext.getCmp("selectSchool").enable();district_data.id=this.district_id;var a=this.school_id;Ext.getStore("SchoolStore").proxy.url="routes/routes.php?url=/schools/"+a+"/login_info";Ext.getStore("SchoolStore").load({callback:function(d,c,e){Ext.getCmp("comboSchool").select(a);var b=Ext.getCmp("comboSchool").findRecord("id",a);Ext.getCmp("school_login_panel").expand();Ext.getCmp("school_login_panel").show();if(b.data.HasPassword){setTimeout(function(){Ext.getCmp("school_with_password").show()},250)}else{setTimeout(function(){Ext.getCmp("school_without_password").show()},250)}}});Ext.getStore("ClassStore").proxy.url="routes/routes.php?url=/schools/"+this.school_id+"/children";Ext.getStore("ClassStore").load()},load_district_login:function(){Ext.getCmp("selectDistrict").setTitle(this.district_name);Ext.getCmp("selectState").setTitle(this.state_name);Ext.getCmp("selectCountry").setTitle(this.country_name);Ext.getCmp("selectCountry").enable();Ext.getCmp("selectState").enable();Ext.getCmp("selectDistrict").enable();var a=this.district_id;district_data.id=this.district_id;district_data.name=this.district_name;Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+a+"/login_info&method=get",success:function(b){var c=Ext.decode(b.responseText);if(c.use_login){Ext.getCmp("school_selection_window").hide();var d=Ext.create("BigBrainzLauncher.view.LoginWindow");d.show();return}},failure:function(){}});Ext.getStore("SchoolStore").proxy.url="routes/routes.php?url=/districts/"+a+"/children";setTimeout(function(){Ext.getCmp("selectSchool").enable();Ext.getCmp("selectSchool").expand()},500)},display_default:function(){Ext.getCmp("selectCountry").setTitle("United States");country_data.id="BB01NOIP82414221620080617T170530968Z";country_data.name="United States";this.country_id=country_data.id;this.country_name=country_data.name;var a=new Date();var b=new Date(a.getFullYear()+1,a.getMonth(),a.getDate());Ext.util.Cookies.set("__country_id_saved",country_data.id,b);Ext.util.Cookies.set("__country_name_saved",country_data.name,b);setTimeout(function(){Ext.getCmp("selectState").enable();Ext.getCmp("selectCountry").collapse()},250)}});Ext.define("BigBrainzLauncher.view.Viewport",{extend:"BigBrainzLauncher.view.SchoolSelectionWindow",renderTo:Ext.getBody()});Ext.define("BigBrainzLauncher.model.CountryModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"name"}],validations:[{type:"presence",field:"id"},{type:"presence",field:"name"}]});Ext.define("BigBrainzLauncher.model.StateModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"name"}],validations:[{type:"presence",field:"id"},{type:"presence",field:"name"}]});Ext.define("BigBrainzLauncher.model.DistrictModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"name"},{name:"UseLogin"}],validations:[{type:"presence",field:"id"},{type:"presence",field:"name"}]});Ext.define("BigBrainzLauncher.model.GameDataModel",{extend:"Ext.data.Model",fields:[{name:"weekly_time"},{name:"fact_grid"},{name:"pretest_grid"},{name:"posttest_grid"}]});Ext.define("BigBrainzLauncher.model.SchoolModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"name"},{name:"Password"},{name:"DefaultStudentPassword"},{name:"status"},{name:"cEmail"},{name:"cName"},{name:"cPhone"},{name:"HasPassword"},{name:"messages_read"},{name:"purchase_status"},{name:"weekly_progress_ta9"},{name:"weekly_progress_addsub"},{name:"weekly_progress_division"},{name:"pretests_ta9"},{name:"posttests_ta9"},{name:"pretests_division"},{name:"posttests_division"},{name:"pretests_addsub"},{name:"posttests_addsub"},{name:"il_school",type:"boolean"}],validations:[{type:"presence",field:"id"},{type:"presence",field:"name"}]});Ext.define("BigBrainzLauncher.model.TestModel",{extend:"Ext.data.Model",fields:[{name:"percent",type:"int"},{name:"value",type:"int"}]});Ext.define("BigBrainzLauncher.model.SubjectModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"name"},{name:"appid"}]});Ext.define("BigBrainzLauncher.model.GameModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"name"},{name:"progress",type:"int"},{name:"password"},{name:"progress_report"}]});Ext.define("BigBrainzLauncher.view.StudentViewport",{extend:"Ext.container.Viewport",id:"student_viewport",layout:{type:"fit"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",layout:{align:"stretch",type:"vbox"},items:[{xtype:"container",height:90,html:'<div id="banner">\r\n	<div id="banner-left"></div>\r\n    <div id="banner-content"></div>\r\n	<div id="banner-right"></div>\r\n</div>\r\n<div id="logo"></div>\r\n<div id="pizza"></div>',maxHeight:90,minHeight:90,minWidth:200,width:200},{xtype:"panel",flex:1,autoScroll:true,layout:{align:"stretch",type:"hbox"},title:"You are logged in as a student",items:[{xtype:"panel",flex:1,id:"student_class_list",minWidth:580,autoScroll:true,layout:{type:"fit"},dockedItems:[{xtype:"toolbar",dock:"top",height:35,items:[{xtype:"combobox",id:"student_class_combobox",width:200,fieldLabel:"Class",labelWidth:50,displayField:"name",store:"ClassStore",valueField:"id",listeners:{select:{fn:a.onComboboxSelect,scope:a}}},{xtype:"tbspacer",flex:1}]}],items:[{xtype:"gridpanel",id:"student_classes_games_grid",autoScroll:true,title:"",store:"GameStore",columns:[{xtype:"gridcolumn",dataIndex:"name",text:"Name",flex:1}],listeners:{selectionchange:{fn:a.onStudent_classes_games_gridSelectionChange,scope:a}}}]},{xtype:"panel",flex:2,layout:{type:"fit"},dockedItems:[{xtype:"toolbar",dock:"top",height:35,items:[{xtype:"label",flex:1,margins:"1",id:"student_details_title",text:"Student Details"},{xtype:"tbspacer"},{xtype:"tbseparator"},{xtype:"button",handler:function(e,g){var d="turbo";var c=Ext.getStore("ClassStore").find("id",Ext.getCmp("student_class_combobox").value);var h=Ext.getStore("ClassStore").data.items[c].data.name;if(h=="Ninja Apprentice"){d="ninja1"}else{if(h=="Ninja"){d="ninja2"}else{if(h=="Ninja Master"){d="ninja3"}else{if(h=="Ninja Calculated"||h.endsWith("_*")){d="ninjaC"}}}}var b=Ext.getCmp("student_classes_games_grid").getSelectionModel().getSelection()[0].data.id;var f=Ext.getStore("SchoolStore").getById(school_data.id).data.il_school;if(f){b="il"+b}window.location.href="play.php?appid="+d+"&school_id="+school_data.id+"&id="+b},disabled:true,text:"Play Multiplication"},{xtype:"tbseparator"},{xtype:"button",handler:function(c,e){var b=Ext.getCmp("student_classes_games_grid").getSelectionModel().getSelection()[0].data.id;var d=Ext.getStore("SchoolStore").getById(school_data.id).data.il_school;if(d){b="il"+b}window.location.href="play.php?appid=division&school_id="+school_data.id+"&id="+b},disabled:true,text:"Play Division"},{xtype:"tbseparator"},{xtype:"button",handler:function(c,e){var b=Ext.getCmp("student_classes_games_grid").getSelectionModel().getSelection()[0].data.id;var d=Ext.getStore("SchoolStore").getById(school_data.id).data.il_school;if(d){b="il"+b}window.location.href="play.php?appid=addsubtract&school_id="+school_data.id+"&id=&id="+b},disabled:true,text:"Play Addition/Subtraction"},{xtype:"tbseparator"}]}],items:[{xtype:"tabpanel",get_active_tab:function(){var c=this.down("tab");var b="ta9";if(c.next().next().active){b="division"}else{if(c.next().next().next().active){b="addsub"}}return b},activate_tab:function(b){var d=this.down("tab");var f=d.next();var c=f.next();var e=c.next();f.deactivate();c.deactivate();e.deactivate();switch(b.title){case"Multiplication":f.activate();break;case"Division":c.activate();break;case"Addition/Subtraction":e.activate();break}},load_student_data:function(){var c=this.get_active_tab();var b=new Ext.data.JsonStore({model:"BigBrainzLauncher.model.GameModel"});var e=Ext.getCmp("student_classes_games_grid").getSelectionModel().getSelection()[0].data;e.progress=e.progress_report[c].progress;b.loadRawData(e);var d=this.down("chart");d.store=b;d.redraw()},hidden:true,itemId:"student_view_details",activeTab:0,items:[{xtype:"panel",hidden:true,layout:{type:"fit"},title:"Report",items:[{xtype:"container",id:"",autoScroll:true,layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"chart",height:250,id:"",width:400,animate:true,insetPadding:20,store:"GameStore",axes:[{position:"gauge",type:"Gauge",margin:8,maximum:100,minimum:0}],series:[{type:"gauge",angleField:"progress",donut:50}]},{xtype:"container",html:"<div id = 'play_multiplication'>  \r\n  <img src=\"http://bigbrainz.com/games/launcher/images/Button_PlayMultiplication_150.png\" onmouseover=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayMultiplicationHover_150.png'\" onmouseout=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayMultiplication_150.png'\"/>\r\n</div>",id:"mult_div",style:"cursor: pointer;",listeners:{afterrender:{fn:a.onContainerAfterRender21,scope:a}}},{xtype:"container",html:"<div id = 'play_division'>  \r\n  <img src=\"http://bigbrainz.com/games/launcher/images/Button_PlayDivision_150.png\" onmouseover=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayDivisionHover_150.png'\" onmouseout=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayDivision_150.png'\"/>\r\n</div>",id:"div_div",style:"cursor: pointer;",listeners:{afterrender:{fn:a.onContainerAfterRender122,scope:a}}},{xtype:"container",html:"<div id = 'play_addsub'>  \r\n  <img src=\"http://bigbrainz.com/games/launcher/images/Button_PlayAddSub_150.png\" onmouseover=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayAddSubHover_150.png'\" onmouseout=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayAddSub_150.png'\"/>\r\n</div>",id:"addsub_div",style:"cursor: pointer;",listeners:{afterrender:{fn:a.onContainerAfterRender1211,scope:a}}}]}]},{xtype:"panel",layout:{type:"fit"},title:"Multiplication"},{xtype:"panel",layout:{type:"fit"},title:"Division"},{xtype:"panel",layout:{type:"fit"},title:"Addition/Subtraction"}],listeners:{beforetabchange:{fn:a.onStudent_view_detailsBeforeTabChange,scope:a},beforerender:{fn:a.onStudent_view_detailsBeforeRender,scope:a}}}]}],listeners:{afterrender:{fn:a.onStudent_classes_panelAfterRender,scope:a}}}]}],listeners:{afterrender:{fn:a.onStudent_viewportAfterRender,scope:a}}});a.callParent(arguments)},onComboboxSelect:function(d,a,b){Ext.ComponentQuery.query("viewport")[0].down("#student_view_details").hide();Ext.getStore("GameStore").proxy.url="routes/routes.php?url=/classes/"+a[0].data.id+"/children";Ext.getCmp("student_classes_games_grid").store.load({scope:this,callback:function(f,e,g){Ext.getStore("GameStore").filterBy(function(h,k){if(h.get("password")===""){return Ext.getStore("SchoolStore").data.items[0].data.DefaultStudentPassword===Ext.util.Format.trim(StudentPassword.password)}return Ext.util.Format.trim(h.get("password"))===Ext.util.Format.trim(StudentPassword.password)})}});var c=Ext.ComponentQuery.query("toolbar")[2].down().next().next().next();c.disable();c.next().next().disable();c.next().next().next().next().disable()},onStudent_classes_games_gridSelectionChange:function(b,d,c){if(Ext.getCmp("student_classes_games_grid").getSelectionModel().getSelection().length<1){return}var a=Ext.getCmp("student_classes_games_grid").getSelectionModel().getSelection()[0].data.name;var f=Ext.getCmp("student_classes_games_grid").getSelectionModel().getSelection()[0].data.id;Ext.getCmp("student_details_title").setText(a);Ext.ComponentQuery.query("viewport")[0].down("#student_view_details").show();this.down("tabpanel").load_student_data();var e=Ext.ComponentQuery.query("toolbar")[2].down().next().next().next();e.enable();e.next().next().enable();e.next().next().next().next().enable()},onContainerAfterRender21:function(a,b){Ext.get("play_multiplication").on("click",function(h,k){var e="turbo";var d=Ext.getStore("ClassStore").find("id",Ext.getCmp("student_class_combobox").value);var g=Ext.getStore("ClassStore").data.items[d].data.name;if(g=="Ninja Apprentice"){e="ninja1"}else{if(g=="Ninja"){e="ninja2"}else{if(g=="Ninja Master"){e="ninja3"}else{if(g=="Ninja Calculated"||g.endsWith("_*")){e="ninjaC"}}}}var c=Ext.getCmp("student_classes_games_grid").getSelectionModel().getSelection()[0].data.id;var f=Ext.getStore("SchoolStore").getById(school_data.id).data.il_school;if(f){c="il"+c}window.location.href="play.php?appid="+e+"&school_id="+school_data.id+"&id="+c})},onContainerAfterRender122:function(a,b){Ext.get("play_division").on("click",function(e,f){var c=Ext.getCmp("student_classes_games_grid").getSelectionModel().getSelection()[0].data.id;var d=Ext.getStore("SchoolStore").getById(school_data.id).data.il_school;if(d){c="il"+c}window.location.href="play.php?appid=division&school_id="+school_data.id+"&id="+c})},onContainerAfterRender1211:function(a,b){Ext.get("play_addsub").on("click",function(e,f){var c=Ext.getCmp("student_classes_games_grid").getSelectionModel().getSelection()[0].data.id;var d=Ext.getStore("SchoolStore").getById(school_data.id).data.il_school;if(d){c="il"+c}window.location.href="play.php?appid=addsubtract&school_id="+school_data.id+"&id=&id="+c})},onStudent_view_detailsBeforeTabChange:function(d,a,c,b){this.down("tabpanel").activate_tab(a);Ext.getCmp("mult_div").hide();Ext.getCmp("div_div").hide();Ext.getCmp("addsub_div").hide();switch(this.down("tabpanel").get_active_tab()){case"ta9":Ext.getCmp("mult_div").show();break;case"division":Ext.getCmp("div_div").show();break;case"addsub":Ext.getCmp("addsub_div").show();break}this.down("tabpanel").load_student_data();return false},onStudent_view_detailsBeforeRender:function(a,c){var b=this.down("tab");var d=b.next();d.activate();Ext.getCmp("div_div").hide();Ext.getCmp("addsub_div").hide();Ext.getCmp("mult_div").show()},onStudent_classes_panelAfterRender:function(a,b){setTimeout(function(){Ext.getCmp("student_class_combobox").expand()},250)},onStudent_viewportAfterRender:function(b,c){var a=Ext.getStore("SchoolStore").getById(school_data.id).data.status;if(a==="pizza_offer"){Ext.get("pizza").on("click",function(d,e){Ext.Msg.show({title:"Big Brainz",msg:"Little Caesars is offering a free pizza party\nto the first 3rd-grade class at your school\nto finish Timez Attack this year!\n\nTo get started, just invite your Principal to login.",buttons:Ext.Msg.OK,animEl:"elId"})})}else{Ext.get("pizza").hide()}}});Ext.define("BigBrainzLauncher.view.AddStudentsWindow",{extend:"Ext.window.Window",height:584,width:713,layout:{align:"stretch",type:"vbox"},title:"Add Students",modal:true,initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",flex:20,layout:{align:"stretch",type:"hbox"},title:"",items:[{xtype:"gridpanel",flex:1,title:"Preview",columnLines:true,store:"AddGameStore",columns:[{xtype:"gridcolumn",dataIndex:"name",text:"Name",flex:2,editor:{xtype:"textfield"}},{xtype:"gridcolumn",dataIndex:"password",text:"Password",flex:1,editor:{xtype:"textfield"}}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{listeners:{edit:{fn:a.onGridroweditingpluginEdit,scope:a}}})]},{xtype:"panel",flex:1,layout:{type:"fit"},title:"Type in or paste a list of students.",items:[{xtype:"textareafield",fieldLabel:"",emptyText:"Type in or paste a list of students. Unique passwords are not required.  If you DO include unique student passwords use a semicolon to separate student names from their passwords.  i.e. Suzy Smith; susm5",listeners:{change:{fn:a.onAdd_students_textareaChange,scope:a}}}]}]}],dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",style:"border: solid 1px #99BBE8; margin: 0",ui:"footer",items:[{xtype:"tbspacer",flex:2},{xtype:"button",handler:function(k,c){test_button=k;if("undefined"===typeof(k.up("window").down("textarea").value)||k.up("window").down("textarea").value===""){Ext.MessageBox.alert("Big Brainz","Enter in at least one student name.");return}var m=Ext.getCmp("school_tree").getSelectionModel().getSelection();var h=Ext.getStore("ClassStore").data.items[Ext.getStore("ClassStore").find("id",m[0].data.id)];var e=h.data.SizeLimit;var o=Ext.getStore("GameStore").data.items.length;var f=k.up("window").down("textarea").value.split(/\r\n?|\n/g);var d=f.length;if(d<1){Ext.MessageBox.alert("Big Brainz","Enter in at least one student name.");return}if(e&&(d>e-o)){Ext.MessageBox.show({title:"Could not add students",msg:"Could not add students because you are adding more than the maximum("+e+") is allowed for this class."});return}var l="[";for(i=0;i<d;i++){if(f[i]===""){continue}var g=f[i].split(";");if(g[0]===""){continue}var n=g[1];if(n===undefined){n=""}else{n=Ext.util.Format.trim(n)}var b=g[0];b=b.replace(/\t/g," ");l+='{"DisplayableName":"'+b+'", "Password":"'+n+'", "ParentID":"'+m[0].data.id+'"},'}l=l.slice(0,-1);l+="]";k.up("window").disable();Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/games&method=post",params:{new_games:l},success:function(p){var q=Ext.decode(p.responseText);if(q.success){setTimeout(function(){var s;var r=Ext.getCmp("school_tree");while(s=r.getRootNode().childNodes[0]){r.getRootNode().removeChild(s)}Ext.getStore("SchoolTreeStore").load();Ext.getStore("GameStore").load();k.up("window").hide();k.up("window").destroy()},1000)}else{k.up("window").enable();Ext.MessageBox.show({title:"Could not add students",msg:q.error})}},failure:function(){Ext.Msg.alert("Could not add students.  Please try again.");k.up("window").enable()}})},disabled:true,height:50,width:200,text:"Add"},{xtype:"tbspacer",flex:2}]}],listeners:{destroy:{fn:a.onAdd_students_windowDestroy,scope:a}}});a.callParent(arguments)},onGridroweditingpluginEdit:function(e,d,c){var a=this.down("grid").store.data.items;var f="";for(var b=0;b<a.length;b++){f+=a[b].get("name")+"; "+a[b].get("password")+"\n"}this.down("textarea").setValue(f)},onAdd_students_textareaChange:function(g,f,c,d){this.down("grid").store.removeAll();var b=f.split("\n");var e=b.length;if(e>0){this.down("button").enable()}else{this.down("button").disable()}for(i=0;i<e;i++){if(b[i]===""){continue}var a=b[i].split(";");if(a[1]===undefined||Ext.util.Format.trim(a[1])===""){a[1]=Ext.getStore("SchoolStore").data.items[0].data.DefaultStudentPassword}game=Ext.create("BigBrainzLauncher.model.GameModel",{name:Ext.util.Format.trim(a[0]),id:i,password:Ext.util.Format.trim(a[1])});this.down("grid").store.add(game)}},onAdd_students_windowDestroy:function(a,b){Ext.getStore("AddGameStore").removeAll()}});Ext.define("BigBrainzLauncher.view.AddClassesWindow",{extend:"Ext.window.Window",height:584,id:"add_classes_window",width:713,layout:{align:"stretch",type:"vbox"},title:"Add Classes",modal:true,initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",flex:20,layout:{align:"stretch",type:"hbox"},title:"",items:[{xtype:"gridpanel",flex:1,id:"add_classes_grid",title:"Preview",columns:[{xtype:"gridcolumn",dataIndex:"name",text:"Class Name",flex:1}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{listeners:{edit:{fn:a.onGridroweditingpluginEdit,scope:a}}})]},{xtype:"panel",flex:1,layout:{type:"fit"},title:"Type in or paste a list of class names",items:[{xtype:"textareafield",id:"add_classes_textarea",fieldLabel:"",emptyText:"Type in or paste a list of classes",listeners:{change:{fn:a.onAdd_students_textareaChange,scope:a}}}]}]}],dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",style:"border: solid 1px #99BBE8; margin: 0",ui:"footer",items:[{xtype:"tbspacer",flex:2},{xtype:"button",handler:function(b,e){if("undefined"===typeof(Ext.getCmp("add_classes_textarea").value)||Ext.getCmp("add_classes_textarea").value===""){Ext.MessageBox.alert("Big Brainz","Enter in at least one class name.");return}var g=Ext.getCmp("add_classes_textarea").value.split(/\r\n?|\n/g);var d=g.length;if(d<1){Ext.MessageBox.alert("Big Brainz","Enter in at least one class name.");return}var c="[";var h=school_data.id;if(h===""||h===undefined){h=Ext.util.Cookies.get("__school_id_saved")}for(i=0;i<d;i++){if(g[i]===""){continue}var f=g[i];f=f.replace(/\t/g," ");c+='{"DisplayableName":"'+f+'", "ParentID":"'+h+'"},'}c=c.slice(0,-1);c+="]";Ext.getCmp("add_classes_window").disable();Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/classes&method=post",params:{new_classes:c},success:function(k){var l=Ext.decode(k.responseText);if(l.success){setTimeout(function(){var n;var m=Ext.getCmp("school_tree");while(n=m.getRootNode().childNodes[0]){m.getRootNode().removeChild(n)}Ext.getStore("ClassStore").load();Ext.getStore("SchoolTreeStore").load();Ext.getCmp("add_classes_window").hide();Ext.getCmp("add_classes_window").destroy()},1000)}else{Ext.getCmp("add_classes_window").enable();Ext.MessageBox.show({title:"Could not add classes",msg:l.error})}},failure:function(){Ext.Msg.alert("Could not add classes.  Please try again.");Ext.getCmp("add_classes_window").enable()}})},height:50,id:"add_class_button",width:200,text:"Add"},{xtype:"tbspacer",flex:2}]}],listeners:{afterrender:{fn:a.onAdd_classes_windowAfterRender,scope:a}}});a.callParent(arguments)},onGridroweditingpluginEdit:function(f,e,d){var a=Ext.getCmp("add_classes_grid").store.data.items;var c="";for(var b=0;b<a.length;b++){c+=a[b].get("name")+"\n"}Ext.getCmp("add_classes_textarea").setValue(c)},onAdd_students_textareaChange:function(e,d,a,b){Ext.getCmp("add_classes_grid").store.removeAll();records=d.split("\n");var c=records.length;for(i=0;i<c;i++){if(records[i]===""){continue}_class=Ext.create("BigBrainzLauncher.model.ClassModel",{name:Ext.util.Format.trim(records[i]),id:i});Ext.getCmp("add_classes_grid").store.add(_class)}},onAdd_classes_windowAfterRender:function(a,b){setTimeout(function(){Ext.getCmp("add_classes_textarea").focus();Ext.getCmp("add_classes_grid").store.removeAll()},250)}});Ext.define("BigBrainzLauncher.view.UnlockDeluxeWindow",{extend:"Ext.window.Window",height:576,hidden:false,id:"unlock_deluxe_free_window",width:796,layout:{type:"fit"},title:"Unlock Your Deluxe License",modal:true,initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",layout:{align:"stretch",type:"vbox"},title:"",items:[{xtype:"panel",flex:1,layout:{align:"stretch",type:"hbox"},title:"",items:[{xtype:"container",flex:1,margins:"10",layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"checkboxfield",handler:function(c,b){if(Ext.getCmp("cnInput").validate()&&Ext.getCmp("ceInput").validate()&&Ext.getCmp("cpInput").validate()&&Ext.getCmp("contactResponsibleCheckbox").value&&Ext.getCmp("principalAwareCheckbox").value&&Ext.getCmp("runningCheckbox").value&&Ext.getCmp("scheduleCheckbox").value){Ext.getCmp("pilotBtn").enable()}else{Ext.getCmp("pilotBtn").disable()}},flex:1,id:"contactResponsibleCheckbox",fieldLabel:"",boxLabel:"Yes"}]},{xtype:"container",flex:10,layout:{align:"stretch",type:"vbox"},items:[{xtype:"label",flex:1,margins:"10",padding:"20 0 0 0",style:"font-weight:bold;",text:"#1 Is this the person responsible for fluency at your school?"},{xtype:"container",flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"textfield",validator:function(b){if(b===""){return false}else{return true}},flex:1,id:"cnInput",fieldLabel:"",emptyText:"Contact's Name",listeners:{change:{fn:a.onTextfieldChange,scope:a}}},{xtype:"textfield",validator:function(b){if(b===""){return false}else{return true}},flex:1,id:"ceInput",fieldLabel:"",emptyText:"Contact's Email",regex:/^([\w\-\'\-]+)(\.[\w-\'\-]+)*@([\w\-]+\.){1,5}([A-Za-z]){2,4}$/,listeners:{change:{fn:a.onCeInputChange,scope:a}}},{xtype:"textfield",validator:function(b){if(b===""){return false}else{return true}},flex:1,id:"cpInput",fieldLabel:"",emptyText:"Contact's Phone Number",maskRe:/[\(\)\d-]/,listeners:{change:{fn:a.onCpInputChange,scope:a}}}]}]}]},{xtype:"panel",flex:1,layout:{align:"stretch",type:"hbox"},title:"",items:[{xtype:"container",flex:1,margins:"10",layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"checkboxfield",handler:function(c,b){if(Ext.getCmp("cnInput").validate()&&Ext.getCmp("ceInput").validate()&&Ext.getCmp("cpInput").validate()&&Ext.getCmp("contactResponsibleCheckbox").value&&Ext.getCmp("principalAwareCheckbox").value&&Ext.getCmp("runningCheckbox").value&&Ext.getCmp("scheduleCheckbox").value){Ext.getCmp("pilotBtn").enable()}else{Ext.getCmp("pilotBtn").disable()}},flex:1,id:"principalAwareCheckbox",fieldLabel:"",boxLabel:"Yes"}]},{xtype:"container",flex:10,margins:"10",layout:{align:"stretch",pack:"center",type:"vbox"},items:[{xtype:"label",flex:1,style:"font-weight:bold;\ncursor:pointer;",text:"#2 Has the Principal watched the â€œPrincipalâ€™s Videoâ€? at http://www.bigbrainz.com/Implementation.php?",listeners:{afterrender:{fn:a.onLabelAfterRender,scope:a}}}]}]},{xtype:"panel",flex:1.13,layout:{align:"stretch",type:"hbox"},title:"",items:[{xtype:"container",flex:1,margins:"10",layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"checkboxfield",handler:function(c,b){if(Ext.getCmp("cnInput").validate()&&Ext.getCmp("ceInput").validate()&&Ext.getCmp("cpInput").validate()&&Ext.getCmp("contactResponsibleCheckbox").value&&Ext.getCmp("principalAwareCheckbox").value&&Ext.getCmp("runningCheckbox").value&&Ext.getCmp("scheduleCheckbox").value){Ext.getCmp("pilotBtn").enable()}else{Ext.getCmp("pilotBtn").disable()}},flex:1,id:"runningCheckbox",fieldLabel:"",boxLabel:"Yes"}]},{xtype:"container",flex:10,margins:"10",layout:{align:"stretch",type:"vbox"},items:[{xtype:"label",flex:2,padding:"30 0 0 0",style:"font-weight:bold;",text:"#3 Is Timez Attack installed and functioning smoothly on your system?"},{xtype:"label",flex:1,text:"(If you need any help, please email support@bigbrainz.com or call us (877) 356-7040!)"}]}]},{xtype:"panel",flex:1.25,layout:{align:"stretch",type:"hbox"},title:"",items:[{xtype:"container",flex:1,margins:"10",layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"checkboxfield",handler:function(c,b){if(Ext.getCmp("cnInput").validate()&&Ext.getCmp("ceInput").validate()&&Ext.getCmp("cpInput").validate()&&Ext.getCmp("contactResponsibleCheckbox").value&&Ext.getCmp("principalAwareCheckbox").value&&Ext.getCmp("runningCheckbox").value&&Ext.getCmp("scheduleCheckbox").value){Ext.getCmp("pilotBtn").enable()}else{Ext.getCmp("pilotBtn").disable()}},flex:1,id:"scheduleCheckbox",fieldLabel:"",boxLabel:"Yes"}]},{xtype:"container",flex:10,margins:"10",layout:{align:"stretch",type:"vbox"},items:[{xtype:"label",flex:1,padding:"30 0 0 0",style:"font-weight:bold;",text:"#4 Have you scheduled enough computer time for students to play 30 minutes per week until finished?"},{xtype:"label",flex:1,padding:"5 0 0 0",text:"(You can obviously adapt this step to your needs, but it's proven far more effective to let one class or grade finish at a time rather than unleashing an entire school at once.)"}]}]},{xtype:"panel",flex:1.5,layout:{align:"stretch",type:"vbox"},title:"",items:[{xtype:"label",flex:2,id:"deluxe_offer_title",padding:"10 0 0 0",style:'text-align:center;\nfont-size:200%;\nfont-weight:bold;\nfont-family: Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif;',text:"Unlock Your Deluxe License"},{xtype:"label",flex:0.6,id:"intro_one",style:"text-align:center",text:"Because you have invested precious dollars in this program, we now share an obligation to ensure your students become fluent."},{xtype:"label",flex:0.6,id:"intro_two",style:"text-align:center",text:"Please follow these 4 simple steps to ensure we accomplish that goal."},{xtype:"label",flex:0.6,id:"intro_three",style:"text-align:center",text:"Teachers will also be invited to unlock their own class.  This feature can be disabled under options if necessary."},{xtype:"label",flex:0.25,style:"text-align:center",text:""}]}],dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",items:[{xtype:"tbspacer",flex:1},{xtype:"buttongroup",title:"",columns:2,layout:{columns:2,type:"table"},items:[{xtype:"button",handler:function(h,b){var c=school_data.id;var o=Ext.getCmp("cnInput").value;var m=Ext.getCmp("cpInput").value;var p=Ext.getCmp("ceInput").value;var k=new Date().getTime();var d=Math.floor(k/1000);var n=Ext.getStore("SchoolStore");var g=n.data.items[n.find("id",c)];var l="Unlocking School";var q="Please unlock the deluxe version for:  http://james-pc:4567/schools/"+c;if(g.data.status=="offer_pilot"){l="Unlocking Free School";q="Please free deluxe version for:  http://james-pc:4567/schools/"+c}Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/emails&method=post",params:{to:"clay@bigbrainz.com",from:p,subject:l,message:q},success:function(r){},failure:function(){}});var f={ItemName:c,Contacts_EmailAddress:p,Contacts_Name:o,Contacts_PhoneNumber:m,UnlockedDateTheir:d};if(g.data.status=="offer_pilot"){f.UnlockedDateOur=d}Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/schools&method=put",params:f,success:function(r){if(Ext.getDom("deluxe")){Ext.getDom("deluxe").id="deluxeunlocked";Ext.get("deluxeunlocked").on("click",function(t,u){})}if(Ext.getDom("pilotdeluxe")){Ext.getDom("pilotdeluxe").id="pilotunlocked";Ext.get("pilotunlocked").on("click",function(t,u){})}res=Ext.decode(r.responseText);Ext.getCmp("unlock_deluxe_free_window").destroy();var s='<div style="text-align:center">Congratulations-your Deluxe License is now unlocked!<br />Once your students begin, please ensure they get roughly 30 minutes per week, until they are finished.</div>';if(g.data.status=="offer_pilot"){s='<div styel="text-align:center">Congratulations-you now have a Deluxe â€œPILOT CLASSâ€? with slots for up to 30 students.<br />Please ensure that Pilot students play roughly 30 min each week until finished.<br /><br />(To Pilot our Deluxe Version with more than these 30 students, please call us.)</div>'}Ext.Msg.show({title:"Big Brainz",msg:s,button:Ext.Msg.OK,icon:Ext.Msg.INFO,width:500})},failure:function(){Ext.Msg.alert("Could not unlock deluxe version.  Please try again.")}});if(g.data.status=="offer_pilot"){g.data.status="deluxe";var e="[";e+='{"DisplayableName":"Pilot Class", "PilotClass":"true","SizeLimit":"30", "ParentID":"'+c+'"}';e+="]";Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/classes&method=post",params:{new_classes:e},success:function(r){var s=Ext.decode(r.responseText);if(s.success){setTimeout(function(){var u;var t=Ext.getCmp("school_tree");while(u=t.getRootNode().childNodes[0]){t.getRootNode().removeChild(u)}Ext.getStore("ClassStore").load();Ext.getStore("SchoolTreeStore").load()},1000)}else{Ext.MessageBox.show({title:"Could not add classes",msg:s.error})}},failure:function(){Ext.Msg.alert("Could not unlock deluxe version.  Please try again.")}})}},disabled:true,id:"pilotBtn",text:"Unlock Deluxe License"},{xtype:"button",handler:function(b,c){Ext.getCmp("unlock_deluxe_free_window").destroy()},text:"Finish Later"}]},{xtype:"tbspacer",flex:1}]}],listeners:{afterrender:{fn:a.onPanelAfterRender,scope:a}}}]});a.callParent(arguments)},onTextfieldChange:function(d,c,a,b){if(Ext.getCmp("cnInput").validate()&&Ext.getCmp("ceInput").validate()&&Ext.getCmp("cpInput").validate()&&Ext.getCmp("contactResponsibleCheckbox").value&&Ext.getCmp("principalAwareCheckbox").value&&Ext.getCmp("runningCheckbox").value&&Ext.getCmp("scheduleCheckbox").value){Ext.getCmp("pilotBtn").enable()}else{Ext.getCmp("pilotBtn").disable()}},onCeInputChange:function(d,c,a,b){if(Ext.getCmp("cnInput").validate()&&Ext.getCmp("ceInput").validate()&&Ext.getCmp("cpInput").validate()&&Ext.getCmp("contactResponsibleCheckbox").value&&Ext.getCmp("principalAwareCheckbox").value&&Ext.getCmp("runningCheckbox").value&&Ext.getCmp("scheduleCheckbox").value){Ext.getCmp("pilotBtn").enable()}else{Ext.getCmp("pilotBtn").disable()}},onCpInputChange:function(d,c,a,b){if(Ext.getCmp("cnInput").validate()&&Ext.getCmp("ceInput").validate()&&Ext.getCmp("cpInput").validate()&&Ext.getCmp("contactResponsibleCheckbox").value&&Ext.getCmp("principalAwareCheckbox").value&&Ext.getCmp("runningCheckbox").value&&Ext.getCmp("scheduleCheckbox").value){Ext.getCmp("pilotBtn").enable()}else{Ext.getCmp("pilotBtn").disable()}},onLabelAfterRender:function(a,b){a.getEl().on({click:function(c){var d=window.open("http://www.bigbrainz.com/Implementation.php");if(window.focus){d.focus()}return false},scope:a})},onPanelAfterRender:function(d,e){var b="";var a="";var g="";var f=Ext.getStore("SchoolStore").find("id",school_data.id);var c=Ext.getStore("SchoolStore").data.items[f];Ext.getCmp("cnInput").setValue(c.data.cName);Ext.getCmp("ceInput").setValue(c.data.cEmail);Ext.getCmp("cpInput").setValue(c.data.cPhone);if(c.data.status=="offer_pilot"){Ext.getCmp("deluxe_offer_title").setText("Pilot the Deluxe Version");Ext.getCmp("intro_one").setText("Welcome! Our Pilot program will upgrade an entire class, up to 30 students, to our Deluxe Version.");Ext.getCmp("intro_two").setText("Please follow these 4 simple steps to begin your Pilot and ensure it will be successful.");Ext.getCmp("intro_three").setText("Students who play roughly 30 minutes per week will remain unlocked until they finish!")}}});Ext.define("BigBrainzLauncher.model.TreeModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"text"},{name:"leaf"},{name:"cls"},{defaultValue:false,name:"loaded"},{defaultValue:false,name:"expanded"},{name:"Properties"},{name:"icon"}]});Ext.define("BigBrainzLauncher.view.ReportErrorWindow",{extend:"Ext.window.Window",height:690,id:"report_error_window",width:670,layout:{align:"center",type:"vbox"},title:"Report Error",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"label",style:"text-align:center;\r\nfont-weight:bold;\r\nfont-size:200%;",text:"Oops!"},{xtype:"container",height:30},{xtype:"label",style:"text-align:center",text:"Your last internet message didn't go through.  This could be due to a network issue.  If it is a network issue you should close and restart this program in about 5-10 minutes and it should work."},{xtype:"container",height:25},{xtype:"label",style:"text-align:center",text:"If this error pops up every time, you may have a firewall or a filter blocking our communications.  Please email the following report to support@bigbrainz.com:"},{xtype:"container",height:12},{xtype:"textareafield",flex:1,id:"error_report_textarea",width:500,fieldLabel:"",labelWidth:0},{xtype:"container",height:30,width:630,layout:{pack:"end",type:"hbox"},items:[{xtype:"button",handler:function(b,c){Ext.getCmp("report_error_window").close()},text:"Close"}]}]});a.callParent(arguments)}});Ext.define("BigBrainzLauncher.view.StartupMessageWindow",{extend:"Ext.window.Window",height:291,id:"startup_message_window",width:813,layout:{align:"center",type:"vbox"},title:"Startup Message",modal:true,initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"label",flex:1,style:"{font-size:250%;}",text:"Welcome to the newest version of Big Brainz"},{xtype:"container",flex:4,width:731,layout:{type:"vbox"},items:[{xtype:"label",flex:1,text:"1.  If you're starting a new school year, we suggest deleting all your old classes and starting fresh."},{xtype:"label",flex:1,text:"2.  Pasting in your classes and students is quick and easy, but we can also import an Excel or .csv file for you. "},{xtype:"label",flex:1,width:674,text:"3.  Unlock your Deluxe License / Pilot the Deluxe Version / by pressing the red button above and following the simple checklist that will ensure an effective implementation at your school."}]}],dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",items:[{xtype:"tbspacer",flex:1},{xtype:"tbseparator"},{xtype:"button",handler:function(d,e){var g=Ext.util.Cookies.get("__school_id_saved");var b=Ext.getStore("SchoolStore");var c=Ext.decode(Ext.getStore("SchoolStore").data.items[0].data.messages_read);c.push(0);var f={ItemName:g,messages_read:JSON.stringify(c)};Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/schools&method=put",params:f,success:function(h){Ext.getCmp("startup_message_window").destroy()},failure:function(){Ext.Msg.alert("Could not dave preference.  Please try again.")}})},text:"Okay, I've read and understand this"},{xtype:"tbseparator"},{xtype:"button",handler:function(b,c){Ext.getCmp("startup_message_window").destroy()},text:"Remind me next time I log in."},{xtype:"tbseparator"},{xtype:"tbspacer",flex:1}]}]});a.callParent(arguments)}});Ext.define("BigBrainzLauncher.view.BigBrainzSetup",{extend:"Ext.window.Window",height:290,hidden:false,id:"setup_school_window",width:492,layout:{type:"fit"},title:"Big Brainz Setup",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",layout:{type:"accordion"},title:"",items:[{xtype:"panel",height:200,collapsed:false,title:"1. Contact Info",items:[{xtype:"container",height:200,layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"textfield",validator:function(b){if(b.length<1){return"Required"}return true},id:"name_txt",itemId:"name_text",fieldLabel:"Name",listeners:{change:{fn:a.onName_txtChange,scope:a}}},{xtype:"textfield",validator:function(b){if(b.length<1){return"Required"}return true},id:"role_txt",itemId:"role_txt",fieldLabel:"Role",listeners:{change:{fn:a.onRole_txtChange,scope:a}}},{xtype:"textfield",validator:function(b){if(b.length<1){return"Required."}return true},id:"email_txt",fieldLabel:"Email",regex:/^([\w\-\'\-]+)(\.[\w-\'\-]+)*@([\w\-]+\.){1,5}([A-Za-z]){2,4}$/,listeners:{change:{fn:a.onEmail_txtChange,scope:a}}},{xtype:"textfield",id:"phone_txt",fieldLabel:"Phone #",emptyText:"(optional)",maskRe:/[\(\)\d-]/,listeners:{change:{fn:a.onPhone_txtChange,scope:a}}},{xtype:"container",flex:1,padding:"0 0 0 200",items:[{xtype:"button",handler:function(b,c){Ext.getCmp("password_setup").enable();Ext.getCmp("password_setup").expand()},disabled:true,id:"next_btn",padding:"",text:"Next"}]}]}]},{xtype:"panel",disabled:true,id:"password_setup",collapsed:true,title:"2. Password Setup",items:[{xtype:"container",height:200,layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"textfield",validator:function(b){if(b.length<1){return false}return true},id:"edu_pass",fieldLabel:"Educator Password",labelAlign:"right",labelWidth:160,emptyText:"(at least 6 characters)",minLength:6,listeners:{change:{fn:a.onEdu_passChange,scope:a}}},{xtype:"textfield",validator:function(b){if(Ext.getCmp("edu_pass").value!=b){return"Mismatch Passwords"}else{return true}},id:"edu_pass_conf",fieldLabel:"Confirm Educator Password",labelAlign:"right",labelWidth:160,minLength:6,listeners:{change:{fn:a.onEdu_pass_confChange,scope:a}}},{xtype:"textfield",validator:function(b){if(b.length<3){return false}return true},id:"stu_pass",fieldLabel:"Student Password",labelAlign:"right",labelWidth:160,emptyText:"(at least 3 characters)",minLength:3,listeners:{change:{fn:a.onStu_passChange,scope:a}}},{xtype:"textfield",validator:function(b){if(Ext.getCmp("stu_pass").value!=b){return"Mismatch Passwords"}else{return true}},id:"stu_pass_conf",fieldLabel:"Confirm Student Password",labelAlign:"right",labelWidth:160,minLength:3,listeners:{change:{fn:a.onStu_pass_confChange,scope:a}}},{xtype:"container",flex:1,padding:"0 0 0 275",items:[{xtype:"button",handler:function(e,b){var c=Ext.util.Cookies.get("__school_id_saved");var o=Ext.getCmp("name_txt").value;var d=Ext.getCmp("role_txt").value;var n=Ext.getCmp("phone_txt").value;var p=Ext.getCmp("email_txt").value;var f=Ext.getCmp("edu_pass").value;var l=Ext.getCmp("stu_pass").value;var h=new Date().getTime();var g=Math.floor(h/1000);Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/schools&method=put",params:{ItemName:c,Contacts_EmailAddress:p,Contacts_Role:d,Contacts_Name:o,Contacts_PhoneNumber:n,Timestamp_PasswordFirstSet:g,DefaultStudentPassword:l,Password:f},success:function(r){res=Ext.decode(r.responseText);Ext.getCmp("school_selection_window").destroy();Ext.getCmp("setup_school_window").destroy();var t=Ext.create("BigBrainzLauncher.view.EducatorTreeViewport");var s=Ext.getStore("SchoolStore").data.items[Ext.getStore("SchoolStore").find("id",c)].data;s.cName=o;s.cEmail=p;s.cPhone=n},failure:function(){Ext.Msg.alert("Could not setup school.  Please try again.")}});var m=Ext.util.Cookies.get("__school_name_saved");var k="School set password";var q=m+" school just set a password:  http://james-pc:4567/schools/"+c;q+="\n\nContact name: "+o;q+="\n\nContact role: "+d;q+="\n\nContact phone: "+n;q+="\n\nContact email: "+p;Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/emails&method=post",params:{to:"haley@bigbrainz.com",from:p,subject:k,message:q},success:function(r){},failure:function(){}})},disabled:true,id:"finish_btn",text:"Finish"}]}]}]}]}]});a.callParent(arguments)},onName_txtChange:function(d,c,a,b){var e=true;if(!Ext.getCmp("name_txt").validate()){e=false}if(!Ext.getCmp("role_txt").validate()){e=false}if(!Ext.getCmp("email_txt").validate()){e=false}if(!Ext.getCmp("phone_txt").validate()){e=false}if(e){Ext.getCmp("next_btn").enable()}else{Ext.getCmp("next_btn").disable();Ext.getCmp("password_setup").disable()}},onRole_txtChange:function(d,c,a,b){var e=true;if(!Ext.getCmp("name_txt").validate()){e=false}if(!Ext.getCmp("role_txt").validate()){e=false}if(!Ext.getCmp("email_txt").validate()){e=false}if(!Ext.getCmp("phone_txt").validate()){e=false}if(e){Ext.getCmp("next_btn").enable()}else{Ext.getCmp("next_btn").disable();Ext.getCmp("password_setup").disable()}},onEmail_txtChange:function(d,c,a,b){var e=true;if(!Ext.getCmp("name_txt").validate()){e=false}if(!Ext.getCmp("role_txt").validate()){e=false}if(!Ext.getCmp("email_txt").validate()){e=false}if(!Ext.getCmp("phone_txt").validate()){e=false}if(e){Ext.getCmp("next_btn").enable()}else{Ext.getCmp("next_btn").disable();Ext.getCmp("password_setup").disable()}},onPhone_txtChange:function(d,c,a,b){var e=true;if(!Ext.getCmp("name_txt").validate()){e=false}if(!Ext.getCmp("role_txt").validate()){e=false}if(!Ext.getCmp("email_txt").validate()){e=false}if(!Ext.getCmp("phone_txt").validate()){e=false}if(e){Ext.getCmp("next_btn").enable()}else{Ext.getCmp("next_btn").disable()}},onEdu_passChange:function(d,c,a,b){var e=true;if(!Ext.getCmp("edu_pass").validate()){e=false}if(!Ext.getCmp("edu_pass_conf").validate()){e=false}if(!Ext.getCmp("stu_pass").validate()){e=false}if(!Ext.getCmp("stu_pass_conf").validate()){e=false}if(!Ext.getCmp("name_txt").validate()){e=false}if(!Ext.getCmp("role_txt").validate()){e=false}if(!Ext.getCmp("email_txt").validate()){e=false}if(!Ext.getCmp("phone_txt").validate()){e=false}if(e){Ext.getCmp("finish_btn").enable()}else{Ext.getCmp("finish_btn").disable()}},onEdu_pass_confChange:function(d,c,a,b){var e=true;if(!Ext.getCmp("edu_pass").validate()){e=false}if(!Ext.getCmp("edu_pass_conf").validate()){e=false}if(!Ext.getCmp("stu_pass").validate()){e=false}if(!Ext.getCmp("stu_pass_conf").validate()){e=false}if(!Ext.getCmp("name_txt").validate()){e=false}if(!Ext.getCmp("role_txt").validate()){e=false}if(!Ext.getCmp("email_txt").validate()){e=false}if(!Ext.getCmp("phone_txt").validate()){e=false}if(e){Ext.getCmp("finish_btn").enable()}else{Ext.getCmp("finish_btn").disable()}},onStu_passChange:function(d,c,a,b){var e=true;if(!Ext.getCmp("edu_pass").validate()){e=false}if(!Ext.getCmp("edu_pass_conf").validate()){e=false}if(!Ext.getCmp("stu_pass").validate()){e=false}if(!Ext.getCmp("stu_pass_conf").validate()){e=false}if(!Ext.getCmp("name_txt").validate()){e=false}if(!Ext.getCmp("role_txt").validate()){e=false}if(!Ext.getCmp("email_txt").validate()){e=false}if(!Ext.getCmp("phone_txt").validate()){e=false}if(e){Ext.getCmp("finish_btn").enable()}else{Ext.getCmp("finish_btn").disable()}},onStu_pass_confChange:function(d,c,a,b){var e=true;if(!Ext.getCmp("edu_pass").validate()){e=false}if(!Ext.getCmp("edu_pass_conf").validate()){e=false}if(!Ext.getCmp("stu_pass").validate()){e=false}if(!Ext.getCmp("stu_pass_conf").validate()){e=false}if(!Ext.getCmp("name_txt").validate()){e=false}if(!Ext.getCmp("role_txt").validate()){e=false}if(!Ext.getCmp("email_txt").validate()){e=false}if(!Ext.getCmp("phone_txt").validate()){e=false}if(e){Ext.getCmp("finish_btn").enable()}else{Ext.getCmp("finish_btn").disable()}}});Ext.define("BigBrainzLauncher.view.StudentNeedPassword",{extend:"Ext.window.Window",height:220,id:"student_need_password",width:400,title:"Need Password?",initComponent:function(){var a=this;Ext.applyIf(a,{listeners:{beforeadd:{fn:a.onStudent_need_passwordBeforeAdd,scope:a}},items:[{xtype:"container",height:200,layout:{align:"center",type:"vbox"},items:[{xtype:"label",flex:1,id:"contact_intro_label",text:"You will need to contact your school contact person who is"},{xtype:"label",flex:1,id:"contact_info",text:"[Contact Info]"},{xtype:"label",flex:1,id:"contact_ending_label",text:"to get this schools password."}]}]});a.callParent(arguments)},onStudent_need_passwordBeforeAdd:function(b,d,c,e){var g=Ext.util.Cookies.get("__school_id_saved");var a=Ext.getStore("SchoolStore").find("id",g);var f=Ext.getStore("SchoolStore").data.items[a].data;Ext.getCmp("contact_info").setText(f.cName+" at "+f.cEmail)}});Ext.define("BigBrainzLauncher.model.ClassModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"name"},{name:"email"},{name:"game_count"},{name:"PilotClass"},{name:"SizeLimit"},{name:"m_pretest_taken"},{name:"m_pretest_avg"},{name:"m_posttest_taken"},{name:"m_posttest_avg"},{name:"m_total_hours"},{name:"m_avg_time"},{name:"m_10"},{name:"m_20"},{name:"m_30"},{name:"m_40"},{name:"m_50"},{name:"m_60"},{name:"m_70"},{name:"m_80"},{name:"m_90"},{name:"d_10"},{name:"d_20"},{name:"d_30"},{name:"d_40"},{name:"d_50"},{name:"d_60"},{name:"d_70"},{name:"d_80"},{name:"d_90"},{name:"d_pretest_taken"},{name:"d_pretest_avg"},{name:"d_posttest_taken"},{name:"d_posttest_avg"},{name:"d_total_hours"},{name:"d_avg_time"},{name:"as_pretest_taken"},{name:"as_pretest_avg"},{name:"as_posttest_taken"},{name:"as_posttest_avg"},{name:"as_total_hours"},{name:"as_avg_time"},{name:"as_10"},{name:"as_20"},{name:"as_30"},{name:"as_40"},{name:"as_50"},{name:"as_60"},{name:"as_70"},{name:"as_80"},{name:"as_90"},{name:"PizzaPartyClass"}]});Ext.define("BigBrainzLauncher.view.LoginWindow",{extend:"Ext.window.Window",height:222,id:"login_window",width:488,layout:{align:"center",pack:"center",type:"vbox"},title:"Login",modal:true,initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"label",padding:"20 20 0 20",style:"text-align:center;",text:"This district requires you to use a username and password."},{xtype:"label",padding:"5 20 20 20",text:"If you do not have this information, please ask your teacher."},{xtype:"textfield",id:"login_username",fieldLabel:"Username"},{xtype:"textfield",id:"login_password",fieldLabel:"Password",inputType:"password",minLength:1,minLengthText:"Password field must not be blank."},{xtype:"container",width:250,layout:{type:"hbox"},items:[{xtype:"container",flex:1},{xtype:"button",handler:function(c,d){Ext.define("student_data",{singleton:true,id:"",name:"",username:""});var e=Ext.getCmp("login_username").value;var b=Ext.getCmp("login_password").value;if(e==="district"){this.login_district(b);return}if(e==="school"){this.login_school(b);return}Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/login/student&method=post",params:{username:e,password:b},success:function(f){var h=Ext.decode(f.responseText);if(h.success){if(Ext.getCmp("login_window")===undefined){}else{Ext.getCmp("login_window").destroy()}if(Ext.getCmp("school_selection_window")===undefined){}else{Ext.getCmp("school_selection_window").destroy()}student_data.id=h.data[0].id;student_data.name=h.data[0].name;student_data.username=h.data[0].name;school_data.id=h.data[0].school_id;Ext.getStore("GameStore").loadRawData(h);var g=Ext.create("BigBrainzLauncher.view.StudentLoginViewport")}else{Ext.Msg.alert("Could not log in.  Please try again.")}},failure:function(){Ext.Msg.alert("Could not log in.  Please try again.")}})},login_school:function(b){Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/login/school&method=post",params:{id:district_data.id,password:b},success:function(c){var e=Ext.decode(c.responseText);if(e.success){if(Ext.getCmp("login_window")===undefined){}else{Ext.getCmp("login_window").destroy()}school_data.id=e.school_id;school_data.name=e.school_name;var d=new Date();var f=new Date(d.getFullYear()+1,d.getMonth(),d.getDay());Ext.util.Cookies.set("__school_id_saved",school_data.id,f);Ext.util.Cookies.set("__school_name_saved",school_data.name,f);Ext.getStore("ClassStore").proxy.url="routes/routes.php?url=/schools/"+school_data.id+"/children";Ext.getStore("SchoolStore").proxy.url="routes/routes.php?url=/schools/"+school_data.id+"/login_info";Ext.getStore("ClassStore").load({callback:function(k,h,l){Ext.getStore("SchoolStore").load({callback:function(n,m,p){var o=Ext.create("BigBrainzLauncher.view.EducatorTreeViewport")}})}});var g=Ext.create("BigBrainzLauncher.view.EducatorTreeViewport")}else{Ext.Msg.alert("Could not log in.  Please try again.")}},failure:function(){Ext.Msg.alert("Could not log in.  Please try again.")}})},login_district:function(b){Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/login/district&method=post",params:{id:district_data.id,password:b},success:function(c){var d=Ext.decode(c.responseText);if(d.success){if(Ext.getCmp("login_window")===undefined){}else{Ext.getCmp("login_window").destroy()}Ext.getCmp("school_selection_window").destroy();Ext.create("BigBrainzLauncher.view.DistrictOverview")}else{Ext.Msg.alert("Could not log in.  Please try again.")}},failure:function(){Ext.Msg.alert("Could not log in.  Please try again.")}})},text:"Login"}]},{xtype:"container",width:450,layout:{type:"hbox"},items:[{xtype:"container",flex:1},{xtype:"button",handler:function(b,c){var d=Ext.MessageBox.prompt("District Password","Please enter your district password.  If you don't know it, please call Big Brainz:",function(f,e){if(f=="ok"){Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/login/district&method=post",params:{id:district_data.id,password:e},success:function(g){var h=Ext.decode(g.responseText);if(h.success){Ext.getCmp("login_window").destroy();Ext.create("BigBrainzLauncher.view.DistrictOverview")}else{Ext.Msg.alert("Incorrect Password",h.message);Ext.getCmp("comboSchool").setValue("")}},failure:function(){Ext.Msg.alert("Could not log in.  Please try again.");Ext.getCmp("comboSchool").setValue("")}})}else{Ext.getCmp("comboSchool").setValue("")}});d.textField.inputEl.dom.type="password";return},hidden:true,text:"View District Progress"}]}],listeners:{beforeclose:{fn:a.onLogin_windowBeforeClose,scope:a}}});a.callParent(arguments)},onLogin_windowBeforeClose:function(a,b){Ext.getCmp("selectDistrict").expand();Ext.getCmp("school_selection_window").show()}});Ext.define("BigBrainzLauncher.view.StudentLoginViewport",{extend:"Ext.container.Viewport",layout:{type:"fit"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",id:"student_classes_details_panel",layout:{type:"fit"},items:[{xtype:"tabpanel",id:"student_view_details",activeTab:0,items:[{xtype:"panel",layout:{type:"fit"},title:"Multiplication",items:[{xtype:"container",id:"student_view_multiplication_container",autoScroll:true,layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"chart",height:250,id:"student_view_multiplication_gauge",width:400,animate:true,insetPadding:20,store:"GameStore",axes:[{position:"gauge",type:"Gauge",margin:8,maximum:100,minimum:0}],series:[{type:"gauge",angleField:"multiplication_progress",donut:50}]},{xtype:"container",flex:1,id:"progress_table"},{xtype:"container",html:"<div id = 'play_multiplication'>  \r\n  <img src=\"http://bigbrainz.com/games/launcher/images/Button_PlayMultiplication_150.png\" onmouseover=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayMultiplicationHover_150.png'\" onmouseout=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayMultiplication_150.png'\"/>\r\n</div>",style:"cursor: pointer;",listeners:{afterrender:{fn:a.onContainerAfterRender,scope:a}}}]}]},{xtype:"panel",layout:{type:"fit"},title:"Division",items:[{xtype:"container",id:"student_view_division_container",autoScroll:true,layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"chart",height:250,id:"student_view_division_gauge",width:400,animate:true,insetPadding:20,store:"GameStore",axes:[{position:"gauge",type:"Gauge",margin:8,maximum:100,minimum:0}],series:[{type:"gauge",angleField:"Division_progress",donut:50}]},{xtype:"container",html:"<div id = 'play_division'>  \r\n  <img src=\"http://bigbrainz.com/games/launcher/images/Button_PlayDivision_150.png\" onmouseover=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayDivisionHover_150.png'\" onmouseout=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayDivision_150.png'\"/>\r\n</div>",style:"cursor: pointer;",listeners:{afterrender:{fn:a.onContainerAfterRender1,scope:a}}}]}],listeners:{activate:{fn:a.onPanelActivate,scope:a}}},{xtype:"panel",layout:{type:"fit"},title:"Addition/Subtraction",items:[{xtype:"container",id:"student_view_addsub_container",autoScroll:true,layout:{align:"center",pack:"center",type:"vbox"},items:[{xtype:"chart",height:250,id:"student_view_addsub_gauge",width:400,animate:true,insetPadding:20,store:"GameStore",axes:[{position:"gauge",type:"Gauge",margin:8,maximum:100,minimum:0}],series:[{type:"gauge",angleField:"addsubtract_progress",donut:50}]},{xtype:"container",html:"<div id = 'play_addsub'>  \r\n  <img src=\"http://bigbrainz.com/games/launcher/images/Button_PlayAddSub_150.png\" onmouseover=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayAddSubHover_150.png'\" onmouseout=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayAddSub_150.png'\"/>\r\n</div>",style:"cursor: pointer;",listeners:{afterrender:{fn:a.onContainerAfterRender11,scope:a}}}]}],listeners:{activate:{fn:a.onPanelActivate1,scope:a}}}]}],listeners:{afterlayout:{fn:a.onStudent_classes_details_panelAfterLayout,scope:a}}}]});a.callParent(arguments)},onContainerAfterRender:function(a,b){Ext.get("play_multiplication").on("click",function(c,d){window.location.href="play.php?appid=turbo&school_id="+school_data.id+"&id="+student_data.id})},onContainerAfterRender1:function(a,b){Ext.get("play_division").on("click",function(c,d){window.location.href="play.php?appid=division&school_id="+school_data.id+"&id="+student_data.id})},onPanelActivate:function(a,b){setTimeout(function(){Ext.getCmp("student_view_division_container").layout.layout()},100)},onContainerAfterRender11:function(a,b){Ext.get("play_addsub").on("click",function(c,d){window.location.href="play.php?appid=addsubtract&school_id="+school_data.id+"&id="+student_data.id})},onPanelActivate1:function(a,b){setTimeout(function(){Ext.getCmp("student_view_addsub_container").layout.layout()},100)},onStudent_classes_details_panelAfterLayout:function(a,c,b){setTimeout(function(){Ext.getCmp("student_view_multiplication_container").layout.layout()},100)}});Ext.define("BigBrainzLauncher.view.PizzaPartySignup",{extend:"Ext.window.Window",height:718,id:"PizzaPartySignup",width:815,title:"Pizza Party",modal:true,initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",height:800,layout:{align:"center",type:"vbox"},items:[{xtype:"label",padding:10,style:"font-size:300%;text-align:center;font-weight:bold;",text:"Finish Timez Attackâ€”Get a Pizza Party!"},{xtype:"label",padding:10,style:"font-size:150%;text-align:justify;font-weight:bold;",text:"Big Brainz and Little Caesars have teamed up to help every 3rd-grader in Utah master their multiplication facts this year by giving a free pizza party to the first 3rd-grade class in the school to finish Timez Attack!"},{xtype:"form",height:147,padding:10,width:766,layout:{align:"stretch",pack:"center",padding:"",type:"vbox"},bodyPadding:10,items:[{xtype:"textfield",id:"principal_name",fieldLabel:"Principal Name"},{xtype:"textfield",id:"principal_email",fieldLabel:"Principal Email"},{xtype:"textfield",id:"address",width:600,fieldLabel:"Address to mail pizza party certificate to",labelWidth:250},{xtype:"fieldcontainer",layout:{align:"stretchmax",type:"hbox"},fieldLabel:"",labelAlign:"right",items:[{xtype:"textfield",id:"city",width:266,fieldLabel:"City",labelWidth:50},{xtype:"textfield",id:"state",width:227,fieldLabel:"State",labelAlign:"right",labelWidth:50},{xtype:"textfield",id:"zip",width:230,fieldLabel:"Zip",labelAlign:"right",labelWidth:50}]}],listeners:{afterrender:{fn:a.onFormAfterRender,scope:a}}},{xtype:"form",height:200,id:"class_list_checkbox",width:747,layout:{align:"stretchmax",type:"vbox"},bodyPadding:10,title:"",items:[{xtype:"label",style:"font-size:150%;text-align:center;",width:710,text:"Classes that will need to become fluent:"},{xtype:"label",style:"color:red;text-align:center;",width:710,text:"Please ensure that all 3rd-grade classes are set up and selected before submitting."},{xtype:"container",flex:1,id:"class_list_signup",style:"border-style:solid;\r\nborder-width:1px;",tpl:['<table style="margin-left: auto;margin-right: auto;">','  <tpl for=".">','    <tpl if="(xindex - 1) &lt; (xcount / 2)">',"      <tr>","        <td>",'          <input type="checkbox" id ="{id}_checkbox" /> {name}',"        </td>",'        <tpl if="parent[xindex - 1 + Math.ceil(xcount / 2)] != undefined">','          <td width = "20"></td>',"          <td>",'            <input type="checkbox" id ="{[parent[xindex - 1 + Math.ceil(xcount / 2)].id]}_checkbox" /> {[parent[xindex - 1 + Math.ceil(xcount / 2)].name]} ',"          </td>","        </tpl>      ","      </tr>			","    </tpl>","  </tpl>","</table>"],width:722,autoScroll:true,listeners:{afterrender:{fn:a.onContainerAfterRender,scope:a}}}]},{xtype:"checkboxfield",id:"principal_checkbox",fieldLabel:"",boxLabel:"I am the Principal and we would like to shoot for the pizza party.  Thanks!"},{xtype:"container",minHeight:30,width:778,layout:{align:"stretchmax",pack:"center",type:"hbox"},items:[{xtype:"button",handler:function(k,c){var d=Ext.getCmp("principal_name").value;var l=Ext.getCmp("principal_email").value;var m=Ext.getCmp("address").value;var g=Ext.getCmp("city").value;var b=Ext.getCmp("state").value;var e=Ext.getCmp("zip").value;if(d===""||l===""||m===""||g===""||b===""||e===""||d===undefined||l===undefined||m===undefined||g===undefined||b===undefined||e===undefined){Ext.Msg.show({title:"Big Brainz",msg:"Oops, we're missing some contact info.",buttons:Ext.Msg.OK,animEl:"elId"});return}var h=[];Ext.each(Ext.query("input[id^=BB]"),function(p){if(p.checked){h.push(p.id.substring(0,p.id.length-9));var q=p.id.substring(0,p.id.length-9);var o=Ext.getStore("SchoolTreeStore").getNodeById(q);var n=Ext.get(Ext.getCmp("school_tree").view.getNode(o));Ext.get(n.id).addCls("pizzaclassred")}});if(h.length<1){Ext.Msg.show({title:"Big Brainz",msg:"Oops, please select all your 3rd-grade classes.",buttons:Ext.Msg.OK,animEl:"elId"});return}if(h.length<1){Ext.Msg.show({title:"Big Brainz",msg:"Oops, please confirm that you are the principal.",buttons:Ext.Msg.OK,animEl:"elId"});return}if(!Ext.getCmp("principal_checkbox").checked){Ext.Msg.show({title:"Big Brainz",msg:"Please check off that you are the principal of this school.",buttons:Ext.Msg.OK,animEl:"elId"});return}var f={};f.id=school_data.id;f.school_name=school_data.name;if(f.school_name===""){f.school_name=Ext.util.Cookies.get("__school_name_saved")}f.name=d;f.email=l;f.address=m;f.city=g;f.state=b;f.zip=e;f.class_ids=Ext.encode(h);Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/pizzapartysignup&method=post",params:f,callback:function(o,p,n){if(!p){}else{Ext.getDom("pizza").id="deluxeunlocked";Ext.Msg.show({title:"Big Brainz",msg:"Congratulations--You're on your way to a pizza party!",buttons:Ext.Msg.OK,animEl:"elId"});Ext.getCmp("PizzaPartySignup").close()}}})},text:"Submit"},{xtype:"container",width:30},{xtype:"button",handler:function(b,c){Ext.getCmp("PizzaPartySignup").close()},text:"Cancel"}]},{xtype:"label",padding:"10 0 0 0",style:"font-size:90%",text:"DETAILS AND CUSTOMIZATION"},{xtype:"label",padding:"0 10 10 10",style:"font-size:90%;text-align:justify;",text:"Little Caesars is donating a pizza party for one 3rd-grade class to invited schools only. Consolation parties for the other classes are strongly encouraged, but are at your own discretion. You may adapt these requirements as you see fit if some students in the class have special needs. Also, if you are still targeting fluency in 4th-grade you may switch these requirements to that grade. When youâ€™re done, call Big Brainz (877) 356-7040 to verify your success and claim your pizza certificates. This promotion assumes normal class sizes of roughly 20 to 30 students. Please allow 2 to 4 weeks for processing your pizza certificates before the end of the school year. Schools will be responsible for picking up the pizzas from participating franchises, so please double-check that there is a Little Caesars close enough to you."}]}]});a.callParent(arguments)},onFormAfterRender:function(b,c){var a="routes/routes.php?url=/pizzapartysignup/"+school_data.id+"&method=get";Ext.Ajax.request({method:"GET",url:a,success:function(d){var e=Ext.decode(d.responseText);Ext.getCmp("principal_name").setValue(e.principal_name);Ext.getCmp("principal_email").setValue(e.principal_email);Ext.getCmp("address").setValue(e.address);Ext.getCmp("city").setValue(e.city);Ext.getCmp("state").setValue(e.state);Ext.getCmp("zip").setValue(e.zip)}})},onContainerAfterRender:function(b,d){var e=[];var a=Ext.getStore("ClassStore");var f=a.data.items.length;for(var c=0;c<f;c++){e.push({id:a.data.items[c].data.id,name:a.data.items[c].data.name})}Ext.getCmp("class_list_signup").update(e)}});Ext.define("BigBrainzLauncher.view.DeleteMultipleClasses",{extend:"Ext.window.Window",height:487,id:"delete_multiple_classes_window",width:398,layout:{align:"stretch",type:"vbox"},title:"Delete Multiple Classes",modal:true,initComponent:function(){var a=this;Ext.applyIf(a,{dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"tbseparator"},{xtype:"button",handler:function(c,f){var d=Ext.getCmp("advance_settings_grid").getSelectionModel().getSelection();if(d.length<1){Ext.MessageBox.alert("Big Brainz","Please select classes to delete.")}var e=d.length;var b="classes";if(e==1){b="class"}Ext.MessageBox.confirm("Delete Classes?","Are you sure you want to delete "+e+" "+b+"?",function(g){if(g=="yes"){var h=[];for(i=0;i<e;i++){if(d[i].data.PilotClass){continue}h.push(d[i].data.id)}Ext.getCmp("delete_multiple_classes_window").getEl().mask();Ext.getCmp("delete_multiple_classes_window").delete_classes(h,function(){setTimeout(function(){var l;var k=Ext.getCmp("school_tree");while(l=k.getRootNode().childNodes[0]){k.getRootNode().removeChild(l)}Ext.getStore("ClassStore").load();Ext.getStore("SchoolTreeStore").load();Ext.getCmp("delete_multiple_classes_window").getEl().unmask()},1000)})}})},text:"Delete"},{xtype:"tbseparator"}]}],items:[{xtype:"gridpanel",flex:1,id:"advance_settings_grid",store:"ClassStore",columns:[{xtype:"gridcolumn",dataIndex:"name",text:"Class Name",flex:1}],selModel:Ext.create("Ext.selection.CheckboxModel",{})}]});a.callParent(arguments)},delete_classes:function(b,d){var a=[];c(b);function c(e){if(e.length){var h=e.shift();var f=new Date().getTime();f=Math.floor(f/1000);var g={ItemName:h,DeletionDate:f};Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/classes&method=put",params:g,callback:function(l,m,k){if(!m){a.push(h)}c(e)}})}else{d(a)}}}});Ext.define("BigBrainzLauncher.view.EditStudentsWindow",{extend:"Ext.window.Window",height:500,width:712,autoScroll:true,layout:{align:"stretch",type:"vbox"},title:"Edit Student Names/Passwords",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"displayfield",padding:10,width:674,fieldLabel:"Note",hideLabel:true,value:"Select the class you want to edit from the menu on the left. Double-click on a student's name or password to change it."},{xtype:"label",margin:"10px",width:388,text:"If the password is blank, it will automatically be set to the default password."},{xtype:"gridpanel",flex:1,margin:10,header:false,title:"Edit Individual Students",store:"GameStore",columns:[{xtype:"gridcolumn",dataIndex:"name",text:"Name",flex:1,editor:{xtype:"textfield"}},{xtype:"gridcolumn",renderer:function(g,d,c,h,f,e,b){if(g===undefined||g===null||g===""){return"(default password)"}else{return g}},dataIndex:"password",text:"Password",flex:1,editor:{xtype:"textfield"}}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{listeners:{edit:{fn:a.onGridcelleditingpluginEdit,scope:a}}})]}]});a.callParent(arguments)},onGridcelleditingpluginEdit:function(d,f,h){var g=f.record.data.id;var k=f.field;var l=false;var a={ItemName:g};if(k==="name"){a.DisplayableName=f.value}else{if(k==="password"){if(f.value!=="(default password)"){a.Password=f.value}else{Ext.MessageBox.alert("Error","Cannot use '(default password)' as a password.");l=true}}else{Ext.MessageBox.alert("Error","Error editing student information.");l=true}}if(!l){Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/games&method=put",params:a,success:function(e){var m=Ext.decode(e.responseText);if(m.success){Ext.Msg.alert("Success","Update successful.")}else{Ext.Msg.alert("Could not update.","Please try again.")}},failure:function(){Ext.Msg.alert("Could not update.","Please try again.")}});if(k==="name"){var b;var c=Ext.getCmp("school_tree");while(b=c.getRootNode().childNodes[0]){c.getRootNode().removeChild(b)}Ext.getStore("SchoolTreeStore").load();Ext.getStore("GameStore").load()}}}});Ext.define("BigBrainzLauncher.view.EditSchoolPasswordsWindow",{extend:"Ext.window.Window",height:250,width:614,title:"Edit School Passwords",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"fieldcontainer",flex:1,margins:"10",height:120,width:400,fieldLabel:"Change Educator Password",labelAlign:"top",items:[{xtype:"container",items:[{xtype:"textfield",id:"old_password",width:212,fieldLabel:"Old Password",inputType:"password",maxLength:30}]},{xtype:"container",items:[{xtype:"textfield",id:"new_password",width:213,fieldLabel:"New Password",inputType:"password",minLength:6,minLengthText:"The minimum password length is {0}",regex:/[A-z0-9]{6,}/m,regexText:"The password can only contain numbers and letters."},{xtype:"textfield",id:"new_password_again",width:213,fieldLabel:"Reenter",inputType:"password",maxLengthText:"The maximum password length is {0}",minLength:6,minLengthText:"The minimum password length is {0}",regex:/[A-z0-9]{6,}/m,regexText:"The password can only contain numbers and letters."}]},{xtype:"container",items:[{xtype:"button",handler:function(b,d){var c=Ext.getCmp("old_password").value;Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/login&method=post",params:{id:school_data.id,password:c},success:function(e){var g=Ext.decode(e.responseText);if(g.success&&g.access=="educator"){var k=Ext.getCmp("new_password").value;var f=Ext.getCmp("new_password_again").value;if(k==f&&Ext.getCmp("new_password").validate()&&Ext.getCmp("new_password_again").validate()){Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/schools&method=put",params:{ItemName:school_data.id,Password:k},success:function(l){var m=Ext.decode(l.responseText);if(m.success){Ext.Msg.alert("Success","Your password has been updated.")}else{Ext.Msg.alert("Could not update.","Please try again.")}},failure:function(){Ext.Msg.alert("Could not update.","Please try again.")}})}else{var h=k==f?"The new password must be 6 - 30 characters and can only contain letters and numbers.":"The new password fields do not match.  Please try again.";Ext.Msg.alert(h)}}else{Ext.Msg.alert("Could not authenticate","Please check your password and try again.")}},failure:function(){Ext.Msg.alert("Could not authenticate","Please check your password and try again.")}})},text:"Change"}]}]},{xtype:"fieldcontainer",flex:1,margins:"10",height:120,width:400,fieldLabel:"Change Default Student Password",labelAlign:"top",items:[{xtype:"textfield",id:"default_student_password_field",validateOnChange:false,listeners:{afterrender:{fn:a.onDefault_student_password_fieldAfterRender,scope:a}}},{xtype:"button",handler:function(b,c){var d=Ext.getCmp("default_student_password_field").value;Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/schools&method=put",params:{ItemName:school_data.id,DefaultStudentPassword:d},success:function(e){var f=Ext.decode(e.responseText);if(f.success){Ext.Msg.alert("Success","The default password has been updated.")}else{Ext.Msg.alert("Could not update.","Please try again.")}},failure:function(){Ext.Msg.alert("Could not update.","Please try again.")}})},text:"Change"}]}]}]});a.callParent(arguments)},onDefault_student_password_fieldAfterRender:function(a,b){a.value=Ext.getStore("SchoolStore").data.items[0].data.DefaultStudentPassword}});Ext.define("BigBrainzLauncher.view.PretestGraph",{extend:"Ext.container.Container",alias:"widget.pretestgraph",height:250,width:400,layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"label",style:"text-align:center;font-size:200%;font-style:normal",text:"Pre-Test Scores"},{xtype:"chart",flex:1,height:250,width:450,animate:true,insetPadding:20,store:"PretestChartStore",axes:[{type:"Category",fields:["percent"],label:{renderer:function(b){return b+"%"}},position:"bottom"},{type:"Numeric",fields:["value"],majorTickSteps:7,title:"# of Students",decimals:0,minimum:0,position:"left"}],series:[{type:"column",renderer:function(f,b,d,e,c){return Ext.apply(d,{fill:"#ff0000"})},tips:{trackMouse:true,width:100,height:28,renderer:function(d,c){var b="students";if(d.get("value")=="1"){b="student"}this.setTitle(d.get("value")+" "+b+".")}},xField:"percent",yField:"value"}]}]});a.callParent(arguments)}});Ext.define("BigBrainzLauncher.view.AvgerageImprovementGraphs",{extend:"Ext.container.Container",alias:"widget.avgerageimprovementgraphs",width:400,layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"label",style:"text-align:center;font-size:200%;font-style:normal",text:"Average Pre/Post Test"},{xtype:"chart",flex:1,height:270,width:400,animate:true,store:"AverageImprovementStore",theme:"ImprovementChart",axes:[{type:"Category",fields:["grade"],label:{renderer:function(b){var c=b+"th grade";if(b===3){c=b+"rd grade"}return c}},position:"bottom"},{type:"Numeric",fields:["pretest_avg","posttest_avg"],title:"",maximum:100,minimum:0,position:"left"}],series:[{type:"column",highlight:true,label:{field:["pretest_avg","posttest_avg"],display:"middle",renderer:function(b){if(b>0){return b+"%"}return""},color:"#333",font:"14px Helvetica, sans-serif"},title:"['Pre-Test Averages', 'Post-Test Averages']",xField:"grade",yField:["pretest_avg","posttest_avg"]}]}],listeners:{beforeadd:{fn:a.onContainerBeforeAdd,scope:a}}});a.callParent(arguments)},onContainerBeforeAdd:function(a,c,b,d){}});Ext.define("BigBrainzLauncher.view.WeeklyUsageGraph",{extend:"Ext.container.Container",alias:"widget.WeeklyUsageGraph",layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"label",style:"text-align:center;font-size:200%;font-style:normal",text:"Usage"},{xtype:"chart",flex:1,animate:true,insetPadding:20,store:"WeeklyProgressStore",theme:"Fancy",axes:[{type:"Category",fields:["date"],label:{renderer:function(b){if(this.date_seen===undefined){this.date_seen=[]}if(this.month_seen===undefined){this.month_seen=[]}monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var c=b.split("/");if(this.date_seen.indexOf(b)===-1){this.date_seen.push(b);return""}else{if(this.month_seen.indexOf(c[1])===-1){this.month_seen.push(c[1]);return monthNames[c[1]-1]}else{return""}}}},position:"bottom"},{type:"Numeric",fields:["f","p","np"],title:"# of Students",decimals:0,position:"left"}],legend:{position:"float",x:90,y:-15},series:[{type:"area",highlight:true,tips:{trackMouse:true,width:175,height:42,renderer:function(g,f){var e=["January","February","March","April","May","June","July","August","September","October","November","December"];var c=f.storeField;if(g.data===undefined){return}var h=g.data[c];var b="students";if(h===1){b="student"}var d=g.data.timestamp;d=e[d.getMonth()]+" "+d.getDate();var k="";switch(c){case"f":k=h+" "+b+" finished by<br />"+d;break;case"p":k=h+" "+b+" progressing on<br />"+d;break;case"np":k=h+" "+b+" playing but not<br />progressing on "+d;break}this.setTitle(k)}},title:["Fluent","Progressing > 20 min.wk","Not Progressing > 20 min.wk"],xField:"timestamp",yField:["f","p","np"]}],listeners:{refresh:{fn:a.onChartRefresh,scope:a}}}]});a.callParent(arguments)},onChartRefresh:function(b,a){b.axes.items[0].label.date_seen=[];b.axes.items[0].label.month_seen=[]}});Ext.define("BigBrainzLauncher.view.OverviewReportGrid",{extend:"Ext.container.Container",alias:"widget.overviewreportgrid",id:"grid_container",layout:{type:"fit"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"gridpanel",renderNumber:function(b){if(b<1){return""}return b},renderPercentage:function(b){if(b<1||b===""){return""}return b+"%"},colorCell:function(h,f,c,b,e,k,g){if(h===0){return""}var d=this.get_color(h,f,k,g);setTimeout(function(){var n=c.getNode(b);try{var l=Ext.fly(Ext.fly(n).query(".x-grid-cell")[e]).down("div");try{l.dom.style.setProperty("background-color","#"+d)}catch(m){l.dom.style.backgroundColor="#"+d}}catch(m){return}},50)},get_color:function(b,o,c,h){if(b===0||b===" "||b===""){return""}c=typeof c!=="undefined"?c:[255,255,255];h=typeof h!=="undefined"?h:[0,176,240];var m=(b/o)*100;if(m>100){m=100}var r=(h[0]-c[0])/100;var q=(h[1]-c[1])/100;var e=(h[2]-c[2])/100;var d=Math.floor(c[0]+m*r);var g=Math.floor(c[1]+m*q);var p=Math.floor(c[2]+m*e);var l=pad(d.toString(16),2);var n=pad(g.toString(16),2);var k=pad(p.toString(16),2);var f=l+n+k;return f},title:"",store:"DistrictReportStore",columns:[{xtype:"gridcolumn",id:"region_text_name",dataIndex:"name",text:"School"},{xtype:"gridcolumn",renderer:function(g,d,c,h,f,e,b){return this.renderNumber(g)},align:"center",dataIndex:"pretest_taken",text:"Pretest Taken"},{xtype:"gridcolumn",renderer:function(g,d,c,h,f,e,b){return this.renderPercentage(g)},align:"center",dataIndex:"pretest_avg",text:"Pretest Avg"},{xtype:"gridcolumn",renderer:function(h,d,c,k,f,e,b){var g=Ext.getStore("DistrictReportStore").data.items[k].data.pretest_taken;this.colorCell(h,g,b,c,f);return this.renderNumber(h)},width:35,align:"center",dataIndex:"_10",text:"10%"},{xtype:"gridcolumn",renderer:function(h,d,c,k,f,e,b){var g=Ext.getStore("DistrictReportStore").data.items[k].data.pretest_taken;this.colorCell(h,g,b,c,f);return this.renderNumber(h)},width:35,align:"center",dataIndex:"_20",text:"20%"},{xtype:"gridcolumn",renderer:function(h,d,c,k,f,e,b){var g=Ext.getStore("DistrictReportStore").data.items[k].data.pretest_taken;this.colorCell(h,g,b,c,f);return this.renderNumber(h)},width:35,align:"center",dataIndex:"_30",text:"30%"},{xtype:"gridcolumn",renderer:function(h,d,c,k,f,e,b){var g=Ext.getStore("DistrictReportStore").data.items[k].data.pretest_taken;this.colorCell(h,g,b,c,f);return this.renderNumber(h)},width:35,align:"center",dataIndex:"_40",text:"40%"},{xtype:"gridcolumn",renderer:function(h,d,c,k,f,e,b){var g=Ext.getStore("DistrictReportStore").data.items[k].data.pretest_taken;this.colorCell(h,g,b,c,f);return this.renderNumber(h)},width:35,align:"center",dataIndex:"_50",text:"50%"},{xtype:"gridcolumn",renderer:function(h,d,c,k,f,e,b){var g=Ext.getStore("DistrictReportStore").data.items[k].data.pretest_taken;this.colorCell(h,g,b,c,f);return this.renderNumber(h)},width:35,align:"center",dataIndex:"_60",text:"60%"},{xtype:"gridcolumn",renderer:function(h,d,c,k,f,e,b){var g=Ext.getStore("DistrictReportStore").data.items[k].data.pretest_taken;this.colorCell(h,g,b,c,f);return this.renderNumber(h)},width:35,align:"center",dataIndex:"_70",text:"70%"},{xtype:"gridcolumn",renderer:function(h,d,c,k,f,e,b){var g=Ext.getStore("DistrictReportStore").data.items[k].data.pretest_taken;this.colorCell(h,g,b,c,f);return this.renderNumber(h)},width:35,align:"center",dataIndex:"_80",text:"80%"},{xtype:"gridcolumn",renderer:function(h,d,c,k,f,e,b){var g=Ext.getStore("DistrictReportStore").data.items[k].data.pretest_taken;this.colorCell(h,g,b,c,f);return this.renderNumber(h)},width:35,align:"center",dataIndex:"_90",text:"90%"},{xtype:"gridcolumn",renderer:function(h,d,c,k,f,e,b){var g=Ext.getStore("DistrictReportStore").data.items[k].data.pretest_taken;this.colorCell(h,g,b,c,f);return this.renderNumber(h)},align:"center",dataIndex:"posttest_taken",text:"Posttest Taken"},{xtype:"gridcolumn",renderer:function(g,d,c,h,f,e,b){this.colorCell(g,100,b,c,f,[255,255,255],[102,204,0]);return this.renderPercentage(g)},align:"center",dataIndex:"posttest_avg",text:"Posttest Avg"},{xtype:"gridcolumn",renderer:function(g,d,c,h,f,e,b){if(g=="0:00"||g==0){return this.renderNumber()}return g},dataIndex:"total_hours",text:"Total Hours"},{xtype:"gridcolumn",renderer:function(g,d,c,h,f,e,b){if(g=="0:00"||g==0){return this.renderNumber()}return g},dataIndex:"avg_hours",text:"Avg Hours"},{xtype:"gridcolumn",text:"Progress Reports (Coming Soon)",flex:1}]}]});a.callParent(arguments)}});Ext.define("BigBrainzLauncher.view.ImportClassWindow",{extend:"Ext.window.Window",height:584,hidden:false,id:"add_students_window",width:713,layout:{align:"stretch",type:"vbox"},title:"Class List Importer",modal:true,initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",flex:20,layout:{align:"stretch",type:"hbox"},title:"",items:[{xtype:"gridpanel",flex:1,id:"import_grid",title:"Preview",columnLines:true,store:"ImportClassListStore",columns:[{xtype:"gridcolumn",dataIndex:"class_name",text:"Class Name",flex:1},{xtype:"gridcolumn",dataIndex:"student_name",text:"Student Name",flex:1},{xtype:"gridcolumn",dataIndex:"password",text:"Password",flex:1}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{listeners:{edit:{fn:a.onGridroweditingpluginEdit,scope:a}}})]},{xtype:"panel",flex:1,layout:{type:"fit"},title:"Class List",items:[{xtype:"textareafield",id:"add_students_textarea",fieldLabel:"",emptyText:"<class name>;<student name>;<password>",listeners:{change:{fn:a.onAdd_students_textareaChange,scope:a}}}]}]}],dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",style:"border: solid 1px #99BBE8; margin: 0",ui:"footer",items:[{xtype:"tbspacer",flex:2},{xtype:"button",handler:function(f,b){if("undefined"===typeof(Ext.getCmp("add_students_textarea").value)||Ext.getCmp("add_students_textarea").value===""){Ext.MessageBox.alert("Big Brainz","Enter in at least one student name.");return}var g=Ext.getCmp("add_students_textarea").value.split(/\r\n?|\n/g);var c=g.length;if(c<1){Ext.MessageBox.alert("Big Brainz","Enter in at least one student name.");return}var n={};for(i=0;i<c;i++){if(g[i]===""){continue}var e=g[i].split(";");if(e[0]===""){continue}if(e[1]===""){continue}var d=e[0];var k=e[1];var l=e[2];if(l===undefined){l=""}else{l=Ext.util.Format.trim(l)}k=k.replace(/\t/g," ");if(n[d]===undefined){n[d]=[]}n[d].push([k,l])}var m=[];for(d in n){m.push(d)}var h=this.up("window");h.disable();this.import_list(m,n,function(o){if(o.length>0){Ext.MessageBox.alert("Big Brainz","At least one class failed to import.  Please check over the list to see.")}else{Ext.Msg.show({title:"Big Brainz",msg:"Classes and Students added.",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}h.hide();h.destroy();setTimeout(function(){var q;var p=Ext.getCmp("school_tree");while(q=p.getRootNode().childNodes[0]){p.getRootNode().removeChild(q)}Ext.getStore("ClassStore").load();Ext.getStore("SchoolTreeStore").load();Ext.getCmp("add_classes_window").hide();Ext.getCmp("add_classes_window").destroy()},500)})},import_list:function(e,b,f){var d=[];c(e);function c(p){if(p.length){var o=p.shift();var l=b[o];var m=l.length;var k="[";for(i=0;i<m;i++){if(l[i]===""){continue}var n=l[i];var h=n[0];if(h===""){continue}var g=n[1];if(g===undefined){g=""}else{g=Ext.util.Format.trim(g)}h=h.replace(/\t/g," ");k+='{"DisplayableName":"'+h+'", "Password":"'+g+'"},'}k=k.slice(0,-1);k+="]";Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/schools/"+school_data.id+"/class_with_student&method=post",params:{class_name:o,student_names_passwords:k},callback:function(r,s,q){if(!s){d.push(o)}c(p)}})}else{f(d)}}},height:50,id:"add_student_button",width:200,text:"Add"},{xtype:"tbspacer",flex:2}]}]});a.callParent(arguments)},onGridroweditingpluginEdit:function(e,d,c){var a=Ext.getCmp("import_grid").store.data.items;var f="";for(var b=0;b<a.length;b++){f+=a[b].get("class_name")+"; "+a[b].get("student_name")+"; "+a[b].get("password")+"\n"}Ext.getCmp("add_students_textarea").setValue(f)},onAdd_students_textareaChange:function(h,g,c,d){Ext.getStore("ImportClassListStore").removeAll();var b=g.split("\n");var e=b.length;if(e>0){Ext.getCmp("add_student_button").enable()}else{Ext.getCmp("add_student_button").disable()}var f=[];for(i=0;i<e;i++){if(b[i]===""){continue}var a=b[i].split(";");if(a.length<2){continue}if(a[2]===undefined||Ext.util.Format.trim(a[2])===""){a[2]="default"}f.push({class_name:Ext.util.Format.trim(a[0]),student_name:Ext.util.Format.trim(a[1]),password:Ext.util.Format.trim(a[2])})}Ext.getStore("ImportClassListStore").loadRawData(f)}});Ext.define("BigBrainzLauncher.view.PosttestGraph",{extend:"Ext.container.Container",alias:"widget.posttestgraph",height:250,width:400,layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"label",style:"text-align:center;font-size:200%;font-style:normal",text:"Post-Test Scores"},{xtype:"chart",flex:1,height:250,width:450,animate:true,insetPadding:20,store:"PosttestChartStore",axes:[{type:"Category",fields:["percent"],label:{renderer:function(b){return b+"%"}},position:"bottom"},{type:"Numeric",fields:["value"],majorTickSteps:7,title:"# of Students",decimals:0,minimum:0,position:"left"}],series:[{type:"column",renderer:function(f,b,d,e,c){return Ext.apply(d,{fill:"#0066cc"})},tips:{trackMouse:true,width:100,height:28,renderer:function(d,c){var b="students";if(d.get("value")=="1"){b="student"}this.setTitle(d.get("value")+" "+b+".")}},xField:"percent",yField:"value"}]}]});a.callParent(arguments)}});Ext.define("BigBrainzLauncher.view.FluencyTimeGraph",{extend:"Ext.container.Container",alias:"widget.fluencytimegraph",layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"label",style:"text-align:center;font-size:200%;font-style:normal",text:"Current Fluency & Time Invested"},{xtype:"chart",flex:1,animate:true,insetPadding:20,store:"FluencyTimeStore",theme:"FluencyTimeGraph",axes:[{type:"Category",fields:["percent_complete"],title:"",position:"bottom"},{type:"Numeric",fields:["greather_than_360","between_180_360","between_60_180","less_than_60"],title:"# of Students",decimals:0,maximum:200,minimum:0,position:"left"}],series:[{type:"column",highlight:true,tips:{trackMouse:true,width:100,height:28,renderer:function(d,c){var b="students";if(c.value[1]===1){b="student"}this.setTitle(c.value[1]+" "+b)}},title:["Played < 1 Hour","Played 1-3 Hours","Played 3-6 Hours","Played > 6 Hours"],xField:"date",yField:["less_than_60","between_60_180","between_180_360","greather_than_360"],stacked:true}],legend:{position:"float",x:90,y:-15}}]});a.callParent(arguments)}});Ext.define("BigBrainzLauncher.view.StudentReportPage",{extend:"Ext.container.Container",alias:"widget.studentreportpage",hidden:true,autoScroll:true,initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",height:250,layout:{align:"center",type:"vbox"},items:[{xtype:"container",height:150,html:"<div id = 'play_game' align='center'>  \r\n  <img src=\"http://bigbrainz.com/games/launcher/images/Button_PlayMultiplication_150.png\" onmouseover=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayMultiplicationHover_150.png'\" onmouseout=\"this.src='http://bigbrainz.com/games/launcher/images/Button_PlayMultiplication_150.png'\"/>\r\n</div>",style:"cursor: pointer;",width:300,layout:{align:"stretch",type:"vbox"},listeners:{afterrender:{fn:a.onContainerAfterRender211,scope:a}}},{xtype:"label",hidden:true,id:"new_york_proxy_label",style:"color:red;",text:"Please note that many New York Schools have proxies that may interfere with gameplay.  We can quickly solve this problem if you call us at (877) 356-7040"}]},{xtype:"container",height:300,layout:{align:"stretch",type:"hbox"},items:[{xtype:"chart",flex:1,height:250,hidden:true,id:"StudentWeeklyMinutes",width:400,animate:true,insetPadding:20,store:"StudentWeeklyMinutes",axes:[{type:"Category",fields:["week_number"],position:"bottom"},{type:"Numeric",fields:["minutes"],title:"Minutes",decimals:0,position:"left"}],series:[{type:"column",xField:"week_number",yField:"minutes"}]},{xtype:"chart",flex:1,height:250,id:"student_multiplication_gauge",width:400,animate:true,insetPadding:20,store:"GameProgressStore",axes:[{position:"gauge",type:"Gauge",margin:8,maximum:100,minimum:0}],series:[{type:"gauge",angleField:"progress",donut:50}]}]},{xtype:"tabpanel",activeTab:0,items:[{xtype:"panel",title:"Pretest",items:[{xtype:"container",id:"pretest_grid_tpl",tpl:['<table class = "progressGrid">','  <tpl for=".">',"    <tr>",'      <tpl for=".">','        <td class = "{status}">{fact}</td>',"      </tpl>","    </tr>","  </tpl>","</table>  "]}]},{xtype:"panel",title:"Progress",items:[{xtype:"container",id:"progress_grid_tpl",tpl:['<table class = "progressGrid">','  <tpl for=".">',"    <tr>",'      <tpl for=".">','        <td class = "{status}">{fact}</td>',"      </tpl>","    </tr>","  </tpl>","</table>  "]}]},{xtype:"panel",title:"Posttest",items:[{xtype:"container",id:"posttest_grid_tpl",tpl:['<table class = "progressGrid">','  <tpl for=".">',"    <tr>",'      <tpl for=".">','        <td class = "{status}">{fact}</td>',"      </tpl>","    </tr>","  </tpl>","</table>  "]}]}]}]});a.callParent(arguments)},onContainerAfterRender211:function(a,b){Ext.get("play_game").on("click",function(h,k){var e=Ext.getCmp("school_tree").getSelectionModel().getSelection();e=e[0];var c=e.data.id;var d="turbo";var g=Ext.getCmp("school_tree").getSelectionModel().getSelection()[0];var f=g.parentNode.data.text;if(f=="Ninja Apprentice"){d="ninja1"}else{if(f=="Ninja"){d="ninja2"}else{if(f=="Ninja Master"){d="ninja3"}else{if(f=="Ninja Calculated"||f.endsWith("_*")){d="ninjaC"}}}}window.location.href="play.php?appid="+d+"&school_id="+school_data.id+"&id="+c})}});Ext.define("BigBrainzLauncher.store.ClassStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.ClassModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.ClassModel",storeId:"ClassStore",proxy:{type:"ajax",url:"http://bigbrainz.com/games/launcher/routes/routes.php?url=/schools/BB029775160829726550220120224162416192635/classes&_dc=1344636638292&page=1&start=0&limit=25&sort=%5B%7B%22property%22%3A%22name%22%2C%22direction%22%3A%22ASC%22%7D%5D",reader:{type:"json",root:"data"}},sorters:{property:"name"}},a)])}});Ext.define("BigBrainzLauncher.store.DistrictStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.DistrictModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.DistrictModel",storeId:"DistrictStore",proxy:{type:"ajax",url:"http://ec2-23-22-15-51.compute-1.amazonaws.com:4567/countries/123/districts",reader:{type:"json",root:"data"}},sorters:{property:"name"}},a)])}});Ext.define("BigBrainzLauncher.store.CountryStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.CountryModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({autoLoad:true,model:"BigBrainzLauncher.model.CountryModel",storeId:"CountryStore",proxy:{type:"ajax",url:"routes/routes.php?url=/countries",reader:{type:"json",root:"data"},listeners:{exception:{fn:b.onAjaxproxyException,scope:b}}},sorters:{sorterFn:function(d,c){d=d.get("name");c=c.get("name");if(d=="United States"){return -1}if(c=="United States"){return 1}if(d=="United Kingdom"){return -1}if(c=="United Kingdom"){return 1}if(d=="Canada"){return -1}if(c=="Canada"){return 1}return d>c?1:(d<c?-1:0)}}},a)])},onAjaxproxyException:function(d,b,a,c){}});Ext.define("BigBrainzLauncher.store.StateStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.StateModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.StateModel",storeId:"StateStore",proxy:{type:"ajax",url:"http://ec2-23-22-15-51.compute-1.amazonaws.com:4567/countries/123/states",reader:{type:"json",root:"data"}},sorters:{property:"name"}},a)])}});Ext.define("BigBrainzLauncher.store.SchoolStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.SchoolModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.SchoolModel",storeId:"SchoolStore",proxy:{type:"ajax",url:"http://bigbrainz.com/games/launcher/routes/routes.php?url=/schools/BB02691691445219511848020091007190846561510/DefaultStudentPassword",reader:{type:"json",root:"data"}},sorters:{sorterFn:function(d,c){d=d.get("name");c=c.get("name");if(d=="District Overview"){return -1}if(c=="District Overview"){return 1}return d>c?1:(d<c?-1:0)},property:"name"}},a)])}});Ext.define("BigBrainzLauncher.store.SchoolTreeStore",{extend:"Ext.data.TreeStore",requires:["BigBrainzLauncher.model.TreeModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.TreeModel",storeId:"school_tree_store",folderSort:true,root:{text:"School",id:"0",expanded:true,iconCls:"school-icon"},proxy:{type:"ajax",url:"http://bigbrainz.com/games/launcher/routes/school_tree.json",reader:{type:"json"}},sorters:{property:"text"},listeners:{beforeload:{fn:b.onTreestoreBeforeLoad,scope:b}}},a)])},onTreestoreBeforeLoad:function(b,a,c){if(b.proxy.url.indexOf("school_tree")!==-1){return false}}});Ext.define("BigBrainzLauncher.store.WeeklyProgressStore",{extend:"Ext.data.Store",constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({storeId:"MyArrayStore2",fields:[{dateFormat:"timestamp",name:"timestamp",type:"date"},{name:"f",type:"int"},{name:"p",type:"int"},{name:"np",type:"int"},{name:"dnp"},{name:"date",type:"string"}]},a)])}});Ext.define("BigBrainzLauncher.store.AddClassStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.ClassModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.ClassModel",storeId:"MyArrayStore1",proxy:{type:"ajax",url:"",reader:{type:"array"}}},a)])}});Ext.define("BigBrainzLauncher.store.AddGameStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.GameModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.GameModel",storeId:"MyArrayStore",proxy:{type:"ajax",reader:{type:"array"}}},a)])}});Ext.define("BigBrainzLauncher.store.StudentWeeklyMinutes",{extend:"Ext.data.Store",constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({storeId:"StudentWeeklyMinutes",fields:[{name:"week_number"},{name:"minutes"}]},a)])}});Ext.define("BigBrainzLauncher.store.PosttestScoresStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.TestModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({storeId:"SchoolPosttestScoresStore",model:"BigBrainzLauncher.model.TestModel"},a)])}});Ext.define("BigBrainzLauncher.store.GameStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.GameModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.GameModel",storeId:"GameStore",proxy:{type:"ajax",url:"http://bigbrainz.com/games/launcher/routes/routes.php?url=/classes/BB0559fa3d8bf052425598f34b5566c5e0ab0/children",reader:{type:"json",root:"data"}},sorters:{property:"name"}},a)])}});Ext.define("BigBrainzLauncher.store.GameDataStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.GameDataModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.GameDataModel",storeId:"GameDataStore",proxy:{type:"ajax",reader:{type:"json",root:"data"}}},a)])}});Ext.define("BigBrainzLauncher.store.ClassPasswordsStore",{extend:"Ext.data.Store",constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({storeId:"ClassPasswordsStore",proxy:{type:"ajax",reader:{type:"json",root:"data"}},fields:[{name:"name"},{name:"password"}]},a)])}});Ext.define("BigBrainzLauncher.store.DistrictReportStore",{extend:"Ext.data.Store",constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({storeId:"DistrictReportStore",fields:[{name:"name"},{name:"pretest_taken"},{name:"pretest_avg"},{name:"_10"},{name:"_20"},{name:"_30"},{name:"_40"},{name:"_50"},{name:"_60"},{name:"_70"},{name:"_80"},{name:"_90"},{name:"posttest_taken"},{name:"posttest_avg"},{name:"total_hours",type:"int"},{name:"avg_hours"},{name:"id"},{name:"purchase_status"}],sorters:{direction:"DESC",property:"total_hours"}},a)])}});Ext.define("BigBrainzLauncher.store.DistrictTreeStore",{extend:"Ext.data.TreeStore",requires:["BigBrainzLauncher.model.TreeModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.TreeModel",storeId:"DistrictTreeStore",folderSort:true,root:{text:"District",id:"0",expanded:true,iconCls:"treenode-no-icon"},proxy:{type:"ajax",url:"http://bigbrainz.com/games/launcher/routes/school_tree.json",reader:{type:"json"}},sorters:{property:"text"}},a)])}});Ext.define("BigBrainzLauncher.store.GameProgressStore",{extend:"Ext.data.Store",constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({storeId:"MyArrayStore9",fields:[{name:"name"},{name:"pretest"},{name:"progress"},{name:"posttest"},{name:"minutes"},{name:"id"}],sorters:{property:"name"}},a)])}});Ext.define("BigBrainzLauncher.store.AverageImprovementStore",{extend:"Ext.data.Store",constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({storeId:"MyArrayStore8",fields:[{name:"grade"},{name:"pretest_avg"},{name:"posttest_avg"},{name:"pretest_count"},{name:"posttest_count"}]},a)])}});Ext.define("BigBrainzLauncher.store.PretestChartStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.TestModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.TestModel",storeId:"PretestChartStore",proxy:{type:"ajax",reader:{type:"json"}}},a)])}});Ext.define("BigBrainzLauncher.store.SchoolSummary",{extend:"Ext.data.Store",constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({storeId:"MyArrayStore10",fields:[{name:"school_id"},{name:"name"},{name:"hours"},{name:"fluent"},{name:"usage"},{name:"fluency"},{name:"not_fluent"}]},a)])}});Ext.define("BigBrainzLauncher.store.PosttestChartStore",{extend:"Ext.data.Store",requires:["BigBrainzLauncher.model.TestModel"],constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({model:"BigBrainzLauncher.model.TestModel",storeId:"PosttestChartStore",proxy:{type:"ajax",reader:{type:"json"}}},a)])}});Ext.define("BigBrainzLauncher.store.FluencyTimeStore",{extend:"Ext.data.Store",constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({storeId:"FluencyTimeStore",fields:[{name:"percent_complete",type:"int"},{name:"less_than_60",type:"int"},{name:"between_60_180",type:"int"},{name:"between_180_360",type:"int"},{name:"greather_than_360",type:"int"}]},a)])}});Ext.define("BigBrainzLauncher.store.ImportClassListStore",{extend:"Ext.data.Store",constructor:function(a){var b=this;a=a||{};b.callParent([Ext.apply({storeId:"MyArrayStore12",fields:[{name:"class_name"},{name:"student_name"},{name:"password"}]},a)])}});Ext.define("BigBrainzLauncher.view.CommonReportGraphs",{extend:"Ext.container.Container",alias:"widget.commonreportgraphs",requires:["BigBrainzLauncher.view.WeeklyUsageGraph","BigBrainzLauncher.view.AvgerageImprovementGraphs","BigBrainzLauncher.view.PretestGraph","BigBrainzLauncher.view.PosttestGraph","BigBrainzLauncher.view.FluencyTimeGraph"],minHeight:270,autoScroll:true,layout:{type:"table"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"WeeklyUsageGraph",height:271,minHeight:270,width:600},{xtype:"avgerageimprovementgraphs",height:270},{xtype:"pretestgraph"},{xtype:"posttestgraph"},{xtype:"fluencytimegraph",height:270,width:400}]});a.callParent(arguments)}});Ext.define("BigBrainzLauncher.view.EducatorTreeViewport",{extend:"Ext.container.Viewport",requires:["BigBrainzLauncher.view.CommonReportGraphs","BigBrainzLauncher.view.OverviewReportGrid","BigBrainzLauncher.view.StudentReportPage"],id:"educator_tree_viewport",layout:{type:"fit"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",layout:{align:"stretch",type:"vbox"},items:[{xtype:"container",height:90,html:'<div id="banner">\r\n	<div id="banner-left"></div>\r\n    <div id="banner-content"></div>\r\n	<div id="banner-right"></div>\r\n</div>\r\n<div id="logo"></div>\r\n<div id="deluxe"></div>\r\n<div id="il-logo-off"></div>',id:"unlock_container",maxHeight:90,minHeight:90,minWidth:200,width:200},{xtype:"container",flex:1,layout:{align:"stretch",type:"vbox"},items:[{xtype:"toolbar",style:"border: solid 1px #99BBE8; margin: 0;background-color:#D9E5F3;",ui:"footer",items:[{xtype:"button",overflowText:"...",text:"Add",textAlign:"left",menu:{xtype:"menu",minWidth:200,plain:true,items:[{xtype:"menuitem",handler:function(c,b){var d=Ext.create("BigBrainzLauncher.view.ImportClassWindow");d.show()},text:"Import Class List"},{xtype:"menuitem",handler:function(c,b){var d=Ext.create("BigBrainzLauncher.view.AddClassesWindow");d.show()},text:"Add Classes"},{xtype:"menuitem",handler:function(c,b){if(Ext.getCmp("school_tree").getSelectionModel().getSelection().length<1||Ext.getCmp("school_tree").getSelectionModel().getSelection()[0].data.id==="0"){Ext.MessageBox.show({title:"Please select a class",msg:"Please select a class before adding students."})}else{var d=Ext.create("BigBrainzLauncher.view.AddStudentsWindow");d.show()}},text:"Add Students"}]}},{xtype:"tbseparator"},{xtype:"button",text:"Delete",textAlign:"left",menu:{xtype:"menu",minWidth:200,plain:true,items:[{xtype:"menuitem",handler:function(f,e){var c=Ext.getCmp("school_tree").getSelectionModel().getSelection();if(c.length<1){Ext.MessageBox.alert("Big Brainz","Please select a class or student to delete")}c=c[0];if(c.data.id==="0"){Ext.MessageBox.alert("Big Brainz","Please select a class or student to delete")}var d=new Date().getTime();d=Math.floor(d/1000);if(c.data.leaf){Ext.MessageBox.confirm("Delete Student?","Are you sure you want to delete "+c.data.text+"?",function(g){if(g=="yes"){var h={ItemName:c.data.id,DeletionDate:d};Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/games&method=put",params:h,success:function(k){res=Ext.decode(k.responseText);if(res){setTimeout(function(){var m;var l=Ext.getCmp("school_tree");while(m=l.getRootNode().childNodes[0]){l.getRootNode().removeChild(m)}Ext.getStore("ClassStore").load();Ext.getStore("SchoolTreeStore").load()},1000)}else{Ext.Msg.alert(res.error)}},failure:function(){Ext.Msg.alert("Could not delete classes.  Please try again.")}})}})}else{var b=Ext.getStore("ClassStore").data.items[Ext.getStore("ClassStore").find("id",c.data.id)];if(b.data.PilotClass){Ext.MessageBox.show({title:"Cannot Delete This Class",msg:"This is a special class and cannot be deleted."});return}Ext.MessageBox.confirm("Delete Class?",'Are you sure you want to delete "'+c.data.text+"\" class and all of it's students?",function(g){if(g=="yes"){var h={ItemName:c.data.id,DeletionDate:d};Ext.Ajax.request({method:"POST",url:"routes/routes.php?url=/classes&method=put",params:h,success:function(k){res=Ext.decode(k.responseText);if(res){setTimeout(function(){var m;var l=Ext.getCmp("school_tree");while(m=l.getRootNode().childNodes[0]){l.getRootNode().removeChild(m)}Ext.getStore("ClassStore").load();Ext.getStore("SchoolTreeStore").load()},1000)}else{Ext.Msg.alert(res.error)}},failure:function(){Ext.Msg.alert("Could not delete classes.  Please try again.")}})}})}},text:"Delete Selected"},{xtype:"menuitem",handler:function(c,b){var d=Ext.create("BigBrainzLauncher.view.DeleteMultipleClasses");d.show()},text:"Delete Multiple Classes"}]}},{xtype:"tbseparator"},{xtype:"button",overflowText:"...",text:"Edit",textAlign:"left",menu:{xtype:"menu",hidden:true,id:"edit_menu",minWidth:200,plain:true,items:[{xtype:"menuitem",handler:function(c,b){var d=Ext.create("BigBrainzLauncher.view.EditSchoolPasswordsWindow");d.show()},text:"Edit School Passwords"},{xtype:"menuitem",handler:function(d,c){var b=Ext.getCmp("school_tree").getSelectionModel().getSelection();if(b.length<1){Ext.MessageBox.alert("Big Brainz","Please select a class before editing.");return}b=b[0];if(b.data.id==="0"){Ext.MessageBox.alert("Big Brainz","Please select a class before editing.");return}var e=Ext.create("BigBrainzLauncher.view.EditStudentsWindow");e.show()},text:"Edit Student Names/Passwords"}]}},{xtype:"tbseparator"},{xtype:"button",handler:function(b,c){window.location.reload()},text:"Back"},{xtype:"tbseparator"},{xtype:"button",handler:function(b,c){win=Ext.create("BigBrainzLauncher.view.PizzaPartySignup");win.show()},hidden:true,text:"Pizza Party"},{xtype:"tbseparator",hidden:true}]},{xtype:"container",flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"treepanel",load_school_report:function(e,c){var d=this.next().down("tabpanel");Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/schools/"+e+"/weekly_progress",success:function(f){report_data.data=Ext.decode(f.responseText);d.load_weekly_progress()},failure:function(){}});Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+e+"/report/test_scores/pretest&method=get",success:function(f){pretest_data.data=Ext.decode(f.responseText);Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+e+"/report/test_scores/posttest&method=get",success:function(g){posttest_data.data=Ext.decode(g.responseText);d.load_test_scores()},failure:function(){Ext.Msg.alert("Could not load pretest chart data.  Please try again.")}})},failure:function(){Ext.Msg.alert("Could not load pretest chart data.  Please try again.")}});Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/schools/"+e+"/report&method=get",success:function(f){report_grid_data.data=Ext.decode(f.responseText);d.load_grid_progress();if(c){c.hide()}},failure:function(){Ext.Msg.alert("Could load district report.  Please try again.");if(c){c.hide()}}});Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+e+"/avg_test_scores&method=get",success:function(f){avg_improvement.data=Ext.decode(f.responseText);d.load_improvement_chart()},failure:function(){Ext.Msg.alert("Could load district report.  Please try again.")}});var b=this.up("viewport");var d=this.up().down("tabpanel");Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/reports/"+school_data.id+"/current_fluency",success:function(f){b.fluency_data=Ext.decode(f.responseText);d.load_fluency_time_chart()},failure:function(){}})},load_class_report:function(k,c){var h=Ext.getStore("ClassStore").find("id",k);var f=Ext.getStore("ClassStore").data.items[h];var e=this.next().down("tabpanel");var d=f.data.PilotClass;if(d=="True"){d=true}var g=Ext.getStore("SchoolTreeStore").getNodeById(k);Ext.getCmp("school_tree").expandPath(g.getPath());Ext.getCmp("school_tree").selectPath(g.getPath());Ext.getStore("GameStore").clearFilter();Ext.getStore("GameStore").proxy.url="routes/routes.php?url=/classes/"+k+"/children";Ext.getStore("GameStore").load({callback:function(q,m,t){class_report_grid_data.data={ta9:[],division:[],addsub:[],mult:[]};Ext.getStore("GameProgressStore").clearFilter();if(c){c.hide()}var s=Ext.getStore("GameStore").data.items.length;var p="It looks like you have not added any students.  Would you like to add some now?";if(d){p="It looks like you have not added any students to this Pilot Class.  Would you like to add some now?  Remember, you can add up to 30 students who can play the deluxe version of the game."}if(s<1){setTimeout(function(){Ext.MessageBox.confirm("Add Students",p,function(r){if(r=="yes"){var u=Ext.create("BigBrainzLauncher.view.AddStudentsWindow");u.show()}})},500)}else{var o=q.length;for(var n=0;n<o;n++){var l=q[n].data;if(l.progress_report.ta9!==undefined){l.progress_report.ta9.id=l.id;class_report_grid_data.data.ta9.push(l.progress_report.ta9)}if(l.progress_report.division!==undefined){l.progress_report.division.id=l.id;class_report_grid_data.data.division.push(l.progress_report.division)}if(l.progress_report.addsub!==undefined){l.progress_report.addsub.id=l.id;class_report_grid_data.data.addsub.push(l.progress_report.addsub)}if(l.progress_report.mult!==undefined){l.progress_report.mult.id=l.id;class_report_grid_data.data.mult.push(l.progress_report.mult)}}e.load_grid_progress()}}});Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+k+"/report/test_scores/pretest&method=get",success:function(l){pretest_data.data=Ext.decode(l.responseText);Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+k+"/report/test_scores/posttest&method=get",success:function(m){posttest_data.data=Ext.decode(m.responseText);e.load_test_scores()},failure:function(){Ext.Msg.alert("Could not load posttest chart data.  Please try again.")}})},failure:function(){Ext.Msg.alert("Could not load pretest chart data.  Please try again.")}});Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/classes/"+k+"/weekly_progress",success:function(l){report_data.data=Ext.decode(l.responseText);e.load_weekly_progress()},failure:function(){}});Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+k+"/avg_test_scores&method=get",success:function(l){avg_improvement.data=Ext.decode(l.responseText);e.load_improvement_chart()},failure:function(){Ext.Msg.alert("Could load class report.  Please try again.")}});var b=this.up("viewport");var e=this.up().down("tabpanel");Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/reports/"+k+"/current_fluency",success:function(l){b.fluency_data=Ext.decode(l.responseText);e.load_fluency_time_chart()},failure:function(){}})},load_student_report:function(d,b){var c=this.next().down("tabpanel");Ext.getStore("GameProgressStore").clearFilter();Ext.getStore("GameProgressStore").filter("id",d);Ext.getStore("GameDataStore").proxy.url="routes/routes.php?url=/games/"+d+"/report_data";Ext.getStore("GameDataStore").load({callback:function(f,e,g){c.load_student()}});if(b){b.hide()}},is_school_selected:function(){return(this.getSelectionModel().getSelection().length<1||this.getSelectionModel().getSelection()[0].data.id===0)},flex:1,id:"school_tree",width:146,autoScroll:true,header:false,iconCls:"apple-icon",title:"",store:"SchoolTreeStore",folderSort:true,viewConfig:{padding:""},listeners:{select:{fn:a.onSchool_treeSelect,scope:a},itemexpand:{fn:a.onSchool_treeItemExpand,scope:a},beforeload:{fn:a.onSchool_treeBeforeLoad,scope:a},afterrender:{fn:a.onSchool_treeAfterRender,scope:a},load:{fn:a.onSchool_treeLoad,scope:a}}},{xtype:"panel",flex:6,layout:{align:"stretch",type:"vbox"},title:"Reports (Prototype)",items:[{xtype:"tabpanel",load_test_scores:function(){var b=this.active_app_id();if(b=="mult"){b="ta9"}Ext.getStore("PretestChartStore").loadRawData(pretest_data.data[b]);Ext.getStore("PosttestChartStore").loadRawData(posttest_data.data[b])},load_weekly_progress:function(){var b=this.active_app_id();if(b=="mult"){b="ta9"}Ext.getStore("WeeklyProgressStore").loadRawData(Ext.decode(report_data.data[b]))},load_grid_progress:function(){var b=this.active_app_id();var c=this.up().up().down("treepanel");if(c.getSelectionModel().getSelection().length<1||c.getSelectionModel().getSelection()[0].data.id==0){Ext.getStore("DistrictReportStore").loadRawData(report_grid_data.data[b])}else{if(c.getSelectionModel().getSelection()[0].isLeaf()){Ext.getStore("GameProgressStore").loadRawData(class_report_grid_data.data[b])}else{Ext.getStore("GameProgressStore").loadRawData(class_report_grid_data.data[b])}}},load_improvement_chart:function(){var b=this.active_app_id();if(b=="mult"){b="ta9"}Ext.getStore("AverageImprovementStore").loadRawData(data=avg_improvement.data[b])},load_student:function(){var e="Multiplication";var c=this.active_app_id();if(c=="division"){e="Division"}else{if(c=="addsub"){e="AddSub"}}Ext.get("play_game").dom.innerHTML='<img src="http://bigbrainz.com/games/launcher/images/Button_Play'+e+'_150.png" onmouseover="this.src=\'http://bigbrainz.com/games/launcher/images/Button_Play'+e+"Hover_150.png'\" onmouseout=\"this.src='http://bigbrainz.com/games/launcher/images/Button_Play"+e+"_150.png'\">";try{var l=c;if(c=="addsub"){l="addsubtract"}var g=Ext.getStore("GameDataStore").data.items[0].data.weekly_time["TimePlayed"+l];Ext.getStore("StudentWeeklyMinutes").loadRawData(g)}catch(b){Ext.getStore("StudentWeeklyMinutes").loadRawData([{week_number:"Week 1",minutes:0}])}try{var k=Ext.decode(Ext.getStore("GameDataStore").data.items[0].data.fact_grid);var f=Ext.decode(Ext.getStore("GameDataStore").data.items[0].data.pretest_grid);var h=Ext.decode(Ext.getStore("GameDataStore").data.items[0].data.posttest_grid);Ext.getCmp("progress_grid_tpl").update(k[c]);Ext.getCmp("pretest_grid_tpl").update(f[c]);Ext.getCmp("posttest_grid_tpl").update(h[c])}catch(b){console.log(b)}Ext.get("play_game").clearListeners();if(c=="mult"){Ext.get("play_game").hide()}else{Ext.get("play_game").show();Ext.get("play_game").on("click",function(r,s){var n=Ext.getCmp("school_tree").getSelectionModel().getSelection();n=n[0];var d=n.data.id;var o=Ext.getStore("SchoolStore").getById(school_data.id).data.il_school;if(o){d="il"+d}var m="turbo";var q=Ext.getCmp("school_tree").getSelectionModel().getSelection()[0];var p=q.parentNode.data.text;if(p=="Ninja Apprentice"){m="ninja1"}else{if(p=="Ninja"){m="ninja2"}else{if(p=="Ninja Master"){m="ninja3"}else{if(p=="Ninja Calculated"||p.endsWith("_*")){m="ninjaC"}}}}if(c=="division"){m=c}else{if(c=="addsub"){m="addsubtract"}}window.location.href="play.php?appid="+m+"&school_id="+school_data.id+"&id="+d})}},activate_tab:function(c,e){var d=c.down("tab");var h=d.next();var g=h.next();var b=g.next();var f=b.next();h.deactivate();g.deactivate();b.deactivate();f.deactivate();switch(e.title){case"Multiplication":h.activate();break;case"Multiplication(Old)":g.activate();break;case"Division":b.activate();break;case"Addition/Subtraction":f.activate();break}},active_app_id:function(){var c=this.down("tab");var b="ta9";if(c.next().next().active){b="mult"}else{if(c.next().next().next().active){b="division"}else{if(c.next().next().next().next().active){b="addsub"}}}return b},load_fluency_time_chart:function(){var c=this.up("viewport").fluency_data;var b=this.active_app_id();if(b=="mult"){b="multiplication"}if(Ext.getCmp("school_tree").is_school_selected()){if(b=="ta9"){b="merged_ta9_ta12"}}Ext.getStore("FluencyTimeStore").loadRawData(c[b])},flex:1,id:"report_tabs",activeTab:0,items:[{xtype:"panel",autoScroll:true,title:"Reports",tabConfig:{xtype:"tab",hidden:true},items:[{xtype:"container",autoScroll:true,layout:{align:"stretch",type:"vbox"},items:[{xtype:"commonreportgraphs",minHeight:290},{xtype:"overviewreportgrid",flex:1},{xtype:"gridpanel",get_color:function(b,o,c,h){if(b===0||b===" "||b===""){return""}c=typeof c!=="undefined"?c:[255,255,255];h=typeof h!=="undefined"?h:[0,176,240];var m=(b/o)*100;if(m>100){m=100}var r=(h[0]-c[0])/100;var q=(h[1]-c[1])/100;var e=(h[2]-c[2])/100;var d=Math.floor(c[0]+m*r);var g=Math.floor(c[1]+m*q);var p=Math.floor(c[2]+m*e);var l=pad(d.toString(16),2);var n=pad(g.toString(16),2);var k=pad(p.toString(16),2);var f=l+n+k;return f},hidden:true,padding:"5 5 5 5",title:"",columnLines:true,forceFit:true,store:"GameProgressStore",columns:[{xtype:"gridcolumn",dataIndex:"name",tdCls:"center-cell",text:"Name",flex:2},{xtype:"gridcolumn",renderer:function(g,d,c,h,f,e,b){if(g!==""&&g!==undefined&&g>-1){return g+"%"}return""},defaultWidth:75,align:"center",dataIndex:"pretest",tdCls:"center-cell",text:"Pre-Test"},{xtype:"gridcolumn",renderer:function(h,b,e,f,l,k,g){var d=Ext.id();var c=g.up().columns[l].getWidth()-25;Ext.defer(function(){try{Ext.widget("progressbar",{renderTo:d,value:h/100,width:c});Ext.get(d).set({"data-qtip":h+"%"});g.up().doLayout()}catch(m){}},50);return Ext.String.format('<div id="{0}"></div>',d)},dataIndex:"progress",text:"Progress",flex:10},{xtype:"gridcolumn",renderer:function(h,d,c,k,g,f,b){if(h<1){return""}var e=this.get_color(h,100,[255,255,255],[102,204,0]);setTimeout(function(){var n=b.getNode(c);try{var l=Ext.fly(Ext.fly(n).query(".x-grid-cell")[g]).down("div")}catch(m){return h}try{l.dom.style.setProperty("background-color","#"+e)}catch(m){l.dom.style.backgroundColor="#"+e}},50);return h+"%"},defaultWidth:75,align:"center",dataIndex:"posttest",text:"Post-Test"},{xtype:"gridcolumn",renderer:function(l,c,f,h,n,m,k){var d=f.get("pretest");var g=f.get("progress");var e=f.get("posttest");if(g<1&&e<1){return""}if(e>0){return Math.floor(e/d*100-100)+"%"}else{var b=Math.floor(g/d*100-100);if(b<0){b=0}return b+"%"}},defaultWidth:75,align:"center",text:"Improvement"},{xtype:"gridcolumn",renderer:function(h,b,d,e,l,k,f){if(h<1){return""}var c=("00"+h%60).slice(-2);var g=Math.floor(h/60);return g+":"+c},defaultWidth:75,align:"center",dataIndex:"minutes",tdCls:"center-cell",text:"Hours"},{xtype:"gridcolumn",renderer:function(h,b,d,e,l,k,f){if(d.get("progress")>=90){return""}var m=480-Math.floor(480*(d.get("progress")/100));if(m<1){return""}var c=("00"+m%60).slice(-2);var g=Math.floor(m/60);return g+":"+c},defaultWidth:110,align:"center",dataIndex:"minutes",text:"Est. Time Remaining",flex:1}],listeners:{select:{fn:a.onGridpanelSelect2,scope:a}}}]},{xtype:"studentreportpage"}]},{xtype:"panel",iconCls:"mult-icon",title:"Multiplication"},{xtype:"panel",hidden:true,iconCls:"mult-icon",title:"Multiplication(Old)"},{xtype:"panel",iconCls:"div-icon",title:"Division"},{xtype:"panel",iconCls:"addsub-icon",title:"Addition/Subtraction"}],listeners:{beforetabchange:{fn:a.onTabpanelBeforeTabChange,scope:a}}}],listeners:{afterrender:{fn:a.onPanelAfterRender,scope:a}}}]}]}]}],listeners:{afterrender:{fn:a.onEducator_tree_viewportAfterRender,scope:a}}});a.callParent(arguments)},onSchool_treeSelect:function(n,e,g,h){var c=new Ext.LoadMask(this.getEl(),{msg:"Loading.  Please wait..."});c.show();var l=this.down("treepanel");var k=this.down("overviewreportgrid");var d=k.next();var m=this.down("tab");var a=m.next().next();var f=this.down("studentreportpage");var b=f.prev();if(e.data.id==="0"){if(a.active){a.deactivate();a.prev().activate()}a.hide();l.load_school_report(school_data.id,c);d.hide();f.hide();b.show();k.show();return}a.show();if(e.data.leaf){l.load_student_report(e.data.id,c);b.hide();f.show()}else{l.load_class_report(e.data.id,c);k.hide();f.hide();b.show();d.show()}},onSchool_treeItemExpand:function(b,a){if(b.data.leaf){}else{Ext.getStore("GameStore").proxy.url="routes/routes.php?url=/classes/"+b.data.id+"/children";Ext.getStore("GameStore").load({callback:function(d,c,e){}})}},onSchool_treeBeforeLoad:function(b,a,c){Ext.getStore("SchoolTreeStore").getRootNode().data.text=Ext.util.Cookies.get("__school_name_saved")},onSchool_treeAfterRender:function(b,c){var a=new Ext.LoadMask(this.getEl(),{msg:"Loading.  Please wait..."});a.show();this.down("treepanel").load_school_report(school_data.id,a)},onSchool_treeLoad:function(g,e,f,h,k){try{var m=Ext.getStore("SchoolTreeStore").getRootNode();Ext.getCmp("school_tree").expandNode(m);var b=Ext.getStore("ClassStore").data.items.length;for(i=0;i<b;i++){var a=Ext.getStore("ClassStore").data.items[i].data.id;var c=Ext.getStore("SchoolTreeStore").getNodeById(a);var l=Ext.get(Ext.getCmp("school_tree").view.getNode(c));if(l===undefined||l===null){continue}if(Ext.getStore("ClassStore").data.items[i].data.PizzaPartyClass=="true"){Ext.get(l.id).addCls("pizzaclassred")}}}catch(error){}},onGridpanelSelect2:function(d,a,b,c){var f=a.data.id;var e=Ext.getStore("SchoolTreeStore").getNodeById(f);Ext.getCmp("school_tree").selectPath(e.getPath())},onTabpanelBeforeTabChange:function(e,a,c,b){e.activate_tab(e,a);var d=this.down("treepanel");e.load_grid_progress();if(d.getSelectionModel().getSelection().length>0&&d.getSelectionModel().getSelection()[0].isLeaf()){e.load_student()}else{e.load_weekly_progress();e.load_test_scores();e.load_improvement_chart();e.load_fluency_time_chart()}return false},onPanelAfterRender:function(a,c){var b=this.down("tab");var d=b.next();d.activate()},onEducator_tree_viewportAfterRender:function(m,k){Ext.define("report_data",{singleton:true,data:""});Ext.define("report_grid_data",{singleton:true,data:""});Ext.define("pretest_data",{singleton:true,data:""});Ext.define("posttest_data",{singleton:true,data:""});Ext.define("avg_improvement",{singleton:true,data:""});Ext.define("class_report_grid_data",{singleton:true,data:""});if(district_data.id=="BB02691691445231259433720081208183020372969"){this.down("toolbar").hide()}class_report_grid_data.data={ta9:[],division:[],addsub:[],mult:[]};var d;var f=Ext.getCmp("school_tree");while(d=f.getRootNode().childNodes[0]){f.getRootNode().removeChild(d)}var l=this;var p=this.down("tabpanel");Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/reports/"+school_data.id+"/current_fluency",success:function(q){l.fluency_data=Ext.decode(q.responseText);p.load_fluency_time_chart()},failure:function(){}});Ext.getStore("SchoolTreeStore").proxy.url="routes/routes.php?url=/schools/"+school_data.id+"/classes/tree";Ext.getStore("SchoolTreeStore").load({callback:function(r,q,s){if(Ext.getStore("SchoolTreeStore").getRootNode().childNodes.length<1){setTimeout(function(){Ext.MessageBox.confirm("Add Classes","It looks like you have not added any classes.  Would you like to add some now?",function(t){if(t=="yes"){var u=Ext.create("BigBrainzLauncher.view.AddClassesWindow");u.show()}})},1000)}}});var a=Ext.getStore("SchoolStore").getById(school_data.id).data.il_school;if(a){Ext.get("il-logo-off").dom.id="il-logo-on"}var e=Ext.getStore("SchoolStore").getById(school_data.id).data.status;if(e.substring(0,5)=="offer"){Ext.get("deluxe").on("click",function(r,s){var q=Ext.create("BigBrainzLauncher.view.UnlockDeluxeWindow");q.show()})}if(e.substring(0,4)=="free"){Ext.get("deluxe").hide()}else{if(e.substring(0,6)=="deluxe"){Ext.get("deluxe").on("click",function(q,r){});if(Ext.getStore("SchoolStore").getById(school_data.id).data.purchase_status=="free"){Ext.getDom("deluxe").id="pilotunlocked"}else{Ext.getDom("deluxe").id="deluxeunlocked"}}else{if(e==="pizza_offer"){Ext.getDom("deluxe").id="pizza";Ext.get("pizza").on("click",function(r,s){var q=Ext.create("BigBrainzLauncher.view.PizzaPartySignup");q.show()})}else{if(e=="offer_pilot"){Ext.getDom("deluxe").id="pilotdeluxe"}}}}var n=Ext.getStore("SchoolStore");var g=n.data.items[n.find("id",school_data.id)];var c=Ext.decode(g.data.messages_read);c=[0,1,2,3];var o=false;var b=c.length;for(i=0;i<b;i++){if(c[i]===0){o=true;break}}if(!o){var h=Ext.create("BigBrainzLauncher.view.StartupMessageWindow");h.show()}if(state_data.name=="New York"){Ext.getCmp("new_york_proxy_label").show()}}});Ext.define("BigBrainzLauncher.view.AggregatedReportPanel",{extend:"Ext.panel.Panel",alias:"widget.aggregatedreportpanel",requires:["BigBrainzLauncher.view.CommonReportGraphs"],layout:{type:"fit"},title:"Reports (Prototype)",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"tabpanel",load_test_scores:function(){var c=this.down("tab");var b="ta9";if(c.next().next().active){b="division"}else{if(c.next().next().next().active){b="addsub"}}Ext.getStore("PretestChartStore").loadRawData(pretest_data.data[b]);Ext.getStore("PosttestChartStore").loadRawData(posttest_data.data[b])},load_weekly_progress:function(){var c=this.down("tab");var b=Ext.decode(report_data.data.ta9);if(c.next().next().active){b=Ext.decode(report_data.data.division)}else{if(c.next().next().next().active){b=Ext.decode(report_data.data.addsub)}}Ext.getStore("WeeklyProgressStore").loadRawData(b)},load_grid_progress:function(h){var f="Loading.  Please wait...";if(Ext.ieVersion<9&&Ext.ieVersion>0){f="You are using an older version of Internet Explorer.  This may take longer to load.  Please wait."}var b=new Ext.LoadMask(this.up().getEl(),{msg:f});b.show();var e=this.down("tab");var c=report_grid_data.data.ta9;var d="ta9";if(e.next().next().active){c=report_grid_data.data.division;d="division"}else{if(e.next().next().next().active){c=report_grid_data.data.addsub;d="addsub"}}Ext.getStore("DistrictReportStore").loadRawData(c);var g=this.load_template_data();if(h){Ext.getCmp("template_test").update(g);Ext.defer(function(){b.hide()},2000)}else{Ext.getCmp("template_test").update_charts(g,b,d)}},load_improvement_chart:function(){var b=this.down("tab");var c=avg_improvement.data.ta9;if(b.next().next().active){c=avg_improvement.data.division}else{if(b.next().next().next().active){c=avg_improvement.data.addsub}}Ext.getStore("AverageImprovementStore").loadRawData(c)},load_template_data:function(){var e={};var d=[];var b=0;var g=0;var c=Ext.getStore("DistrictReportStore").data.length;for(i=0;i<c;i++){b=Math.max(b,Ext.getStore("DistrictReportStore").data.items[i].data.total_hours,10);g=Math.max(g,Ext.getStore("DistrictReportStore").data.items[i].data.posttest_taken);var f=[];for(j=90;j>=10;j-=10){if(j===90){f.push(Ext.getStore("DistrictReportStore").data.items[i].data["_"+j])}else{f.push(Ext.getStore("DistrictReportStore").data.items[i].data["_"+j]-Ext.getStore("DistrictReportStore").data.items[i].data["_"+(j+10)])}}d.push({name:Ext.getStore("DistrictReportStore").data.items[i].data.name,hours:parseInt(Ext.getStore("DistrictReportStore").data.items[i].data.total_hours,10),avg_hours:parseInt(Ext.getStore("DistrictReportStore").data.items[i].data.total_hours,10)/Ext.getStore("DistrictReportStore").data.items[i].data.pretest_taken,pretest_taken:Ext.getStore("DistrictReportStore").data.items[i].data.pretest_taken,fluent:Ext.getStore("DistrictReportStore").data.items[i].data.posttest_taken,usage:1,fluency:Ext.encode(f.reverse()),school_id:Ext.getStore("DistrictReportStore").data.items[i].data.id})}e.max_total_hours=b;e.max_student_fluent=g;e.rows=d;return e},load_fluency_time_chart:function(){var d=this.up("viewport").fluency_data;var c=this.down("tab");var b="merged_ta9_ta12";if(c.next().next().active){b="division"}else{if(c.next().next().next().active){b="addsub"}}Ext.getStore("FluencyTimeStore").loadRawData(d[b])},activate_tab:function(b){var d=this.down("tab");var f=d.next();var c=f.next();var e=c.next();f.deactivate();c.deactivate();e.deactivate();switch(b.title){case"Multiplication":f.activate();break;case"Division":c.activate();break;case"Addition/Subtraction":e.activate();break}},id:"report_tabs1",activeTab:0,items:[{xtype:"panel",layout:{align:"stretch",type:"vbox"},title:"Reports",tabConfig:{xtype:"tab",hidden:true},items:[{xtype:"commonreportgraphs",minHeight:290},{xtype:"container",flex:1,id:"district_reports_graphs",minHeight:300,autoScroll:true,items:[{xtype:"container",layout:{type:"fit"},items:[{xtype:"progressbar",animate:true}]},{xtype:"container",filter:function(){Ext.getStore("DistrictReportStore").clearFilter(true);var b=[];if(Ext.getCmp("chk_elem").getValue()){b.push("Elementary|El")}if(Ext.getCmp("chk_middle").getValue()){b.push("Middle|Junior")}if(Ext.getCmp("chk_high").getValue()){b.push("High")}var f=b.join("|");var e=new RegExp(f,"i");Ext.getStore("DistrictReportStore").filter("name",e);var c=[];if(Ext.getCmp("chk_paid").getValue()){c.push("paid")}if(Ext.getCmp("chk_free").getValue()){c.push("free")}var d=c.join("|");var g=new RegExp(d,"i");Ext.getStore("DistrictReportStore").filter("purchase_status",g);Ext.getCmp("template_test").update(Ext.getCmp("report_tabs").load_template_data())},height:30,layout:{align:"middle",pack:"center",type:"hbox"},items:[{xtype:"button",handler:function(b,c){Ext.getCmp("chk_elem").setRawValue(0);Ext.getCmp("chk_middle").setRawValue(0);Ext.getCmp("chk_high").setRawValue(0);Ext.getCmp("chk_paid").setRawValue(0);Ext.getCmp("chk_free").setRawValue(0);Ext.getStore("DistrictReportStore").clearFilter();Ext.getCmp("template_test").update(Ext.getCmp("report_tabs").load_template_data())},text:"Show All"},{xtype:"checkboxgroup",border:1,padding:"0 0 0 5",width:300,fieldLabel:"",items:[{xtype:"checkboxfield",handler:function(c,b){this.up().up().filter()},id:"chk_elem",boxLabel:"Elementary"},{xtype:"checkboxfield",handler:function(c,b){this.up().up().filter()},id:"chk_middle",boxLabel:"Middle"},{xtype:"checkboxfield",handler:function(c,b){this.up().up().filter()},id:"chk_high",fieldLabel:"",boxLabel:"High"}]},{xtype:"checkboxgroup",border:1,width:200,fieldLabel:"",items:[{xtype:"checkboxfield",handler:function(c,b){this.up().up().filter()},id:"chk_free",labelWidth:50,boxLabel:"Free"},{xtype:"checkboxfield",handler:function(c,b){this.up().up().filter()},id:"chk_paid",labelWidth:50,boxLabel:"Paid"}]}]},{xtype:"container",update_charts:function(d,l,f){var h=d.rows.length;b(0,h);function b(o,n){var p=d.rows[o].school_id;m(o,p);c(o,p);g(o,p);e(o,p);k(o,p);if(o+1<n){setTimeout(function(){b(o+1,n)},10)}else{if(l){l.hide()}}}function m(p,s){var o=Ext.getCmp("template_test").tpl.fluency_chart_ids;var r=Ext.decode(d.rows[p].fluency);var q=Ext.getCmp(o[s]);var n=q.store;n.loadRawData([{progress:"10%",number_of_students:r[0]},{progress:"20%",number_of_students:r[1]},{progress:"30%",number_of_students:r[2]},{progress:"40%",number_of_students:r[3]},{progress:"50%",number_of_students:r[4]},{progress:"60%",number_of_students:r[5]},{progress:"70%",number_of_students:r[6]},{progress:"80%",number_of_students:r[7]},{progress:"90%",number_of_students:r[8]}]);q.redraw()}function c(q,s){var n=Ext.getCmp("template_test").tpl.total_chart_ids;var p=Ext.decode(d.rows[q].hours);var r=Ext.getCmp(n[s]);var o=r.store;o.loadRawData([{school:"school",hours:p}]);r.redraw()}function g(p,s){var r=Ext.getCmp("template_test").tpl.avg_hours_chart_ids;var o=Ext.decode(d.rows[p].avg_hours);var q=Ext.getCmp(r[s]);var n=q.store;n.loadRawData([{school:"school",hours:o}]);q.redraw()}function e(o,r){var s=Ext.getCmp("template_test").tpl.fluent_chart_ids;var q=Ext.decode(d.rows[o].fluent);var p=Ext.getCmp(s[r]);var n=p.store;n.loadRawData([{school:"school",fluent:q}]);p.redraw()}function k(o,p){var n=Ext.getCmp("template_test").tpl.usage_chart_ids;var q=Ext.getCmp("template_test").tpl.usage_data[p];var r=Ext.getCmp(n[p]);var v=r.store;var s=[{p:0,np:0,dnp:0,f:0,date:""}];if(q[f]!==""){s=Ext.decode(q[f]).slice(Math.max(0,s.length-12))}v.loadRawData(s);r.redraw();var u=0;if(s.length>0){u=s[s.length-1]}var x=Ext.getCmp("template_test").tpl.not_fluent_data[p].not_fluent;x=x-u.p-u.np-u.f;var t=Ext.getCmp(Ext.getCmp("template_test").tpl.not_fluent_chart_ids[p]);var w=t.store;w.loadRawData([{school:"school",not_fluent:x}]);t.redraw()}},id:"template_test",tpl:Ext.create("Ext.XTemplate",'<table style="width:100%;">',"  <tr>",'    <td style="text-align:center;" onclick="Ext.getCmp(\'template_test\').tpl.sort_name();">School</td>','    <td style="text-align:center;" onclick="Ext.getCmp(\'template_test\').tpl.sort_total_hours();">Total<br />Hours</td>    ','    <td style="text-align:center;" onclick="Ext.getCmp(\'template_test\').tpl.sort_avg_hours();">Avg<br />Hours</td>    ','    <td style="text-align:center;" onclick="Ext.getCmp(\'template_test\').tpl.sort_fluents();">Students<br />Fluent</td>','    <td style="text-align:center;">Usage</td>','    <td style="text-align:center;">Fluency</td>','    <td style="text-align:center;">Students<br />Not Progressing</td>',"  </tr>",'  <tpl for="rows">','    <tr id = "{[Ext.id()]}" style = "background-color:{[xindex % 2 === 0 ? "Gainsboro" : "white"]};">',"      <td style=\"text-align:center;font-size:150%;\"><a href=\"javascript:void(0)\" onclick=\"Ext.getCmp('template_test').tpl.log_in_as_educator('{school_id}','{name}');return false;\">{name}</a></td>",'      <td style="text-align:center;">{[this.add_total_hours_data(parent.max_total_hours,values.hours, values.school_id)]}</td>      ','      <td style="text-align:center;">{[this.add_avg_hours_data(values.avg_hours, values.school_id)]}</td>      ','      <td style="text-align:center;">{[this.add_fluent_data(parent.max_student_fluent,values.fluent, values.school_id)]}</td>      ','      <td style="text-align:center;">{[this.display_usage(values.school_id)]}</td>','      <td style="text-align:center;">{[this.add_fluency_data(values.fluency, values.school_id)]}</td>','      <td style="text-align:center;">{[this.add_not_fluent_data(values.pretest_taken,values.pretest_taken-values.fluent, values.school_id)]}</td>',"    </tr>","  </tpl>","</table>","{[this.get_usage_data()]}",{add_total_hours_data:function(b,c,d){if(this.total_hours_school_id_data===undefined){this.total_hours_school_id_data={}}var e=Ext.id();this.total_hours_school_id_data[d]={};this.total_hours_school_id_data[d].max=b;this.total_hours_school_id_data[d].hours=c;this.total_hours_school_id_data[d].div_id=e;return'<div id="'+e+'"></div>'},add_not_fluent_data:function(c,b,d){if(this.not_fluent_data===undefined){this.not_fluent_data={}}var e=Ext.id();this.not_fluent_data[d]={};this.not_fluent_data[d].max=c;this.not_fluent_data[d].not_fluent=b;this.not_fluent_data[d].div_id=e;return'<div id="'+e+'"></div>'},add_fluent_data:function(b,c,d){if(this.fluent_data===undefined){this.fluent_data={}}var e=Ext.id();this.fluent_data[d]={};this.fluent_data[d].max=b;this.fluent_data[d].fluent=c;this.fluent_data[d].div_id=e;return'<div id="'+e+'"></div>'},display_usage:function(b){if(this.usage_graph_data===undefined){this.usage_graph_data=[]}var c=Ext.id();this.usage_graph_data.push({div_id:c,school_id:b});return'<div id="'+c+'"></div>'},get_usage_data:function(){var h=this.fluent_chart_ids;var p=this.fluency_school_id_data;var r=this.total_hours_school_id_data;var l=this.avg_hours_school_id_data;var g=this.fluent_data;var m=this.not_fluent_data;var u=Ext.ComponentQuery.query("viewport")[0].down("progressbar");var v=this;var n=0;var k=this.usage_graph_data.length;o(this.usage_graph_data,function(w){u.hide()});if(this.usage_data===undefined){this.usage_data={}}var t=this.usage_data;var s=this.fluency_data;function o(x,z){var y=[];w(x);function w(B){if(B.length){var A=B.shift();u.updateProgress(n/k,n+" out of "+k+" schools loaded.");n++;Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/schools/"+A.school_id+"/weekly_progress",callback:function(){f(p[A.school_id].div_id,p[A.school_id].data,A.school_id);q(r[A.school_id].div_id,r[A.school_id].max,r[A.school_id].hours,A.school_id);c(l[A.school_id].div_id,l[A.school_id].hours,A.school_id);e(g[A.school_id].div_id,g[A.school_id].max,g[A.school_id].fluent,A.school_id)},success:function(C){try{var G=Ext.decode(C.responseText);t[A.school_id]=G;var E=Ext.decode(G.ta9);b(A.div_id,E,A.school_id);var H=0;if(E.length>0){H=E[E.length-1]}var D=m[A.school_id].not_fluent;D=D-H.p-H.np-H.f;d(m[A.school_id].div_id,m[A.school_id].max,D,A.school_id)}catch(F){y.push(A)}w(B)},failure:function(){y.push(A);w(B)}})}else{z(y)}}}if(this.usage_chart_ids===undefined){this.usage_chart_ids={}}function b(z,x,y){var w=Ext.create("Ext.data.JsonStore",{fields:["date","f","p","np"]});w.loadRawData(x);Ext.defer(function(){try{var A=Ext.create("Ext.chart.Chart",{listeners:{refresh:{fn:function(D,C){D.axes.items[0].label.date_seen=[];D.axes.items[0].label.month_seen=[]}}},xtype:"chart",animate:true,width:400,height:225,insetPadding:20,store:w,theme:"Fancy",renderTo:z,axes:[{type:"Category",fields:["date"],position:"bottom",title:"",label:{renderer:function(C){if(C===undefined){return""}if(this.date_seen===undefined){this.date_seen=[]}if(this.month_seen===undefined){this.month_seen=[]}monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var D=C.split("/");return monthNames[D[1]-1]+" "+D[2]}}},{type:"Numeric",fields:["f","p","np"],position:"left",title:"# of Students",decimals:0,minimum:0,maximum:200}],series:[{type:"area",highlight:true,tips:{trackMouse:true,width:175,height:42,renderer:function(H,G){var F=["January","February","March","April","May","June","July","August","September","October","November","December"];var D=G.storeField;if(H.data===undefined){return}var I=H.data[D];var C="students";if(I===1){C="student"}var E=H.data.date;E=E.split("/");E=F[E[1]-1]+" "+E[2];var J="";switch(D){case"f":J=I+" "+C+" finished by "+E;break;case"p":J=I+" "+C+" progressing on "+E;break;case"np":J=I+" "+C+" playing but not progressing on "+E;break}this.setTitle(J)}},xField:"date",yField:["f","p","np"]}]});v.usage_chart_ids[y]=A.id}catch(B){}},50)}if(this.fluency_chart_ids===undefined){this.fluency_chart_ids={}}function f(B,z,A){try{var w=Ext.create("Ext.data.JsonStore",{fields:["progress","number_of_students"],data:[{progress:"10%",number_of_students:z[0]},{progress:"20%",number_of_students:z[1]},{progress:"30%",number_of_students:z[2]},{progress:"40%",number_of_students:z[3]},{progress:"50%",number_of_students:z[4]},{progress:"60%",number_of_students:z[5]},{progress:"70%",number_of_students:z[6]},{progress:"80%",number_of_students:z[7]},{progress:"90%",number_of_students:z[8]}]});var x=Ext.create("Ext.chart.Chart",{xtype:"chart",animate:true,shadow:true,store:w,renderTo:B,width:400,height:225,axes:[{type:"Numeric",position:"left",fields:["number_of_students"],title:"Number of Students",grid:true,minimum:0,maximum:100},{type:"Category",position:"bottom",fields:["progress"],label:{rotate:{degrees:270}}}],series:[{type:"column",axis:"left",gutter:80,xField:"name",yField:["number_of_students"],renderer:function(G,D,C,F,E){if(F===6||F===7){return Ext.apply(C,{fill:"#FFFF00"})}if(F===8){return Ext.apply(C,{fill:"#66CC00"})}return Ext.apply(C,{fill:"#FF0000"})},tips:{trackMouse:true,width:30,height:45,renderer:function(D,C){this.setTitle(D.get("progress"));this.update(D.get("number_of_students"))}}}]});v.fluency_chart_ids[A]=x.id}catch(y){}}if(this.total_chart_ids===undefined){this.total_chart_ids={}}function q(C,w,x,B){try{var y=Ext.create("Ext.data.JsonStore",{fields:["school","hours"],data:[{school:"school",hours:x}]});var z=Ext.create("Ext.chart.Chart",{xtype:"chart",animate:true,shadow:true,store:y,renderTo:C,width:100,height:225,axes:[{type:"Numeric",hidden:true,position:"left",fields:["hours"],minimum:0,maximum:w},{type:"Category",hidden:true,position:"bottom",fields:["school"]}],series:[{type:"column",axis:"left",gutter:80,xField:"school",yField:["hours"],label:{display:"middle","text-anchor":"middle",field:"hours",renderer:Ext.util.Format.numberRenderer("0"),color:"#333"},renderer:function(H,E,D,G,F){return Ext.apply(D,{fill:"#0066cc"})}}]});v.total_chart_ids[B]=z.id}catch(A){}}if(this.avg_hours_chart_ids===undefined){this.avg_hours_chart_ids={}}function c(B,w,A){try{var x=Ext.create("Ext.data.JsonStore",{fields:["school","hours"],data:[{school:"school",hours:w}]});var y=Ext.create("Ext.chart.Chart",{xtype:"chart",animate:true,shadow:true,store:x,renderTo:B,width:100,height:225,axes:[{type:"Numeric",hidden:true,position:"left",fields:["hours"],minimum:0,maximum:10},{type:"Category",hidden:true,position:"bottom",fields:["school"]}],series:[{type:"column",axis:"left",gutter:80,xField:"school",yField:["hours"],label:{display:"middle","text-anchor":"middle",field:"hours",renderer:Ext.util.Format.numberRenderer("0"),color:"#333"},renderer:function(G,D,C,F,E){return Ext.apply(C,{fill:"#0066cc"})}}]});v.avg_hours_chart_ids[A]=y.id}catch(z){}}if(this.fluent_chart_ids===undefined){this.fluent_chart_ids={}}function e(C,w,A,B){try{var x=Ext.create("Ext.data.JsonStore",{fields:["school","fluent"],data:[{school:"school",fluent:A}]});var y=Ext.create("Ext.chart.Chart",{xtype:"chart",animate:true,shadow:true,store:x,renderTo:C,width:100,height:225,axes:[{type:"Numeric",hidden:true,position:"left",fields:["fluent"],minimum:0,maximum:w},{type:"Category",hidden:true,position:"bottom",fields:["school"]}],series:[{type:"column",axis:"left",gutter:80,xField:"school",yField:["fluent"],label:{display:"middle","text-anchor":"middle",field:"fluent",renderer:Ext.util.Format.numberRenderer("0"),color:"#333"},style:{fill:"#66CC00"}}]});v.fluent_chart_ids[B]=y.id}catch(z){}}if(this.not_fluent_chart_ids===undefined){this.not_fluent_chart_ids={}}function d(C,w,y,B){try{var x=Ext.create("Ext.data.JsonStore",{fields:["school","hours"],data:[{school:"school",not_fluent:y}]});var z=Ext.create("Ext.chart.Chart",{xtype:"chart",animate:true,shadow:true,store:x,renderTo:C,height:225,width:100,axes:[{type:"Numeric",hidden:true,position:"left",fields:["not_fluent"],minimum:0,maximum:w},{type:"Category",hidden:true,position:"bottom",fields:["school"]}],series:[{type:"column",axis:"left",gutter:80,xField:"school",yField:["not_fluent"],label:{display:"middle","text-anchor":"middle",field:"not_fluent",renderer:Ext.util.Format.numberRenderer("0"),color:"#333"},style:{fill:"#FF0000"}}]});v.not_fluent_chart_ids[B]=z.id}catch(A){}}},add_avg_hours_data:function(b,c){if(this.avg_hours_school_id_data===undefined){this.avg_hours_school_id_data={}}var d=Ext.id();this.avg_hours_school_id_data[c]={};this.avg_hours_school_id_data[c].hours=b;this.avg_hours_school_id_data[c].div_id=d;return'<div id="'+d+'"></div>'},log_in_as_educator:function(e,d){var b=new Date();var f=new Date(b.getFullYear(),b.getMonth(),b.getDate(),b.getHours()+4);Ext.util.Cookies.set("__district_overview",true,f);Ext.getCmp("template_test").up("viewport").destroy();school_data.id=e;school_data.name=d;var c=new Date(b.getFullYear()+1,b.getMonth(),b.getDay());Ext.util.Cookies.set("__school_id_saved",school_data.id,c);Ext.util.Cookies.set("__school_name_saved",school_data.name,c);Ext.getStore("ClassStore").proxy.url="routes/routes.php?url=/schools/"+school_data.id+"/children";Ext.getStore("SchoolStore").proxy.url="routes/routes.php?url=/schools/"+school_data.id+"/login_info";Ext.getStore("ClassStore").load({callback:function(h,g,k){Ext.getStore("SchoolStore").load({callback:function(m,l,o){var n=Ext.create("BigBrainzLauncher.view.EducatorTreeViewport")}})}})},sort_name:function(){var b="ASC";if(Ext.getStore("DistrictReportStore").sorters.items[0].property==="name"){if(Ext.getStore("DistrictReportStore").sorters.items[0].direction==="ASC"){b="DESC"}}Ext.getStore("DistrictReportStore").sorters.clear();Ext.getStore("DistrictReportStore").sort("name",b);Ext.getCmp("template_test").update(Ext.getCmp("report_tabs").load_template_data())},sort_total_hours:function(){var b="ASC";if(Ext.getStore("DistrictReportStore").sorters.items[0].property==="hours"){if(Ext.getStore("DistrictReportStore").sorters.items[0].direction==="ASC"){b="DESC"}}Ext.getStore("DistrictReportStore").sorters.clear();Ext.getStore("DistrictReportStore").sort("hours",b);Ext.getCmp("template_test").update(Ext.getCmp("report_tabs").load_template_data())},sort_avg_hours:function(){var b="ASC";if(Ext.getStore("DistrictReportStore").sorters.items[0].property==="avg_hours"){if(Ext.getStore("DistrictReportStore").sorters.items[0].direction==="ASC"){b="DESC"}}Ext.getStore("DistrictReportStore").sorters.clear();Ext.getStore("DistrictReportStore").sort("avg_hours",b);Ext.getCmp("template_test").update(Ext.getCmp("report_tabs").load_template_data())},sort_fluents:function(){var b="ASC";if(Ext.getStore("DistrictReportStore").sorters.items[0].property==="fluent"){if(Ext.getStore("DistrictReportStore").sorters.items[0].direction==="ASC"){b="DESC"}}Ext.getStore("DistrictReportStore").sorters.clear();Ext.getStore("DistrictReportStore").sort("fluent",b);Ext.getCmp("template_test").update(Ext.getCmp("report_tabs").load_template_data())},add_fluency_data:function(b,c){if(this.fluency_school_id_data===undefined){this.fluency_school_id_data={}}var d=Ext.id();b=Ext.decode(b);this.fluency_school_id_data[c]={};this.fluency_school_id_data[c].data=b;this.fluency_school_id_data[c].div_id=d;return'<div id="'+d+'"></div>'}})}]}]},{xtype:"panel",title:"Multiplication"},{xtype:"panel",hidden:true,title:"Division"},{xtype:"panel",hidden:true,title:"Addition/Subtraction"}],listeners:{beforetabchange:{fn:a.onTabpanelBeforeTabChange,scope:a}}}],listeners:{afterrender:{fn:a.onPanelAfterRender,scope:a}}});a.callParent(arguments)},onTabpanelBeforeTabChange:function(e,a,c,b){var d=this.down("tabpanel");d.activate_tab(a);d.load_grid_progress(false);d.load_weekly_progress();d.load_test_scores();d.load_improvement_chart();d.load_fluency_time_chart();return false},onPanelAfterRender:function(a,b){this.setTitle(district_data.name)}});Ext.define("BigBrainzLauncher.view.DistrictOverview",{extend:"Ext.container.Viewport",requires:["BigBrainzLauncher.view.AggregatedReportPanel"],id:"district_overview",layout:{type:"fit"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"aggregatedreportpanel"}],listeners:{afterrender:{fn:a.onDistrict_overviewAfterRender,scope:a}}});a.callParent(arguments)},onDistrict_overviewAfterRender:function(b,d){Ext.define("report_data",{singleton:true,data:""});Ext.define("report_grid_data",{singleton:true,data:""});Ext.define("pretest_data",{singleton:true,data:""});Ext.define("posttest_data",{singleton:true,data:""});Ext.define("avg_improvement",{singleton:true,data:""});var c=this.down("tab");var f=c.next();f.activate();var e="Loading.  Please wait...";if(Ext.ieVersion<9&&Ext.ieVersion>0){e="You are using an older version of Internet Explorer.  This may take longer to load.  Please wait."}var a=new Ext.LoadMask(this.getEl(),{msg:e});a.show();this.load_district_report(district_data.id,a);if(Ext.getCmp("school_selection_window")){Ext.getCmp("school_selection_window").hide()}},load_district_report:function(d,b){var c=this.down("tabpanel");Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+district_data.id+"/weekly_progress",success:function(e){report_data.data=Ext.decode(e.responseText);c.load_weekly_progress()},failure:function(){},callback:function(f,g,e){Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+district_data.id+"/report/test_scores/pretest&method=get",success:function(h){pretest_data.data=Ext.decode(h.responseText);Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+district_data.id+"/report/test_scores/posttest&method=get",success:function(k){posttest_data.data=Ext.decode(k.responseText);c.load_test_scores()},failure:function(){Ext.Msg.alert("Could not load posttest chart data.  Please try again.")}})},failure:function(){Ext.Msg.alert("Could not load pretest chart data.  Please try again.")},callback:function(k,l,h){Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+district_data.id+"/avg_test_scores&method=get",success:function(m){avg_improvement.data=Ext.decode(m.responseText);c.load_improvement_chart()},failure:function(){Ext.Msg.alert("Could load district report.  Please try again.")},callback:function(n,o,m){Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+district_data.id+"/report&method=get",success:function(p){report_grid_data.data=Ext.decode(p.responseText);c.load_grid_progress(true);if(b){b.hide()}},failure:function(){Ext.Msg.alert("Could load district report.  Please try again.");if(b){b.hide()}}})}})}})}});var a=this;Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/reports/"+district_data.id+"/current_fluency",success:function(e){a.fluency_data=Ext.decode(e.responseText);c.load_fluency_time_chart()},failure:function(){}})},load_school_report:function(d,c,a){var b=this.next().down("tabpanel");school_data.id=d;school_data.name=c;Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/schools/"+d+"/weekly_progress",success:function(e){report_data.data=Ext.decode(e.responseText);b.load_weekly_progress()},failure:function(){}});Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+d+"/report/test_scores/pretest&method=get",success:function(e){pretest_data.data=Ext.decode(e.responseText);Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+d+"/report/test_scores/posttest&method=get",success:function(f){posttest_data.data=Ext.decode(f.responseText);b.load_test_scores()},failure:function(){Ext.Msg.alert("Could not load pretest chart data.  Please try again.")}})},failure:function(){Ext.Msg.alert("Could not load pretest chart data.  Please try again.")}});Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/schools/"+d+"/report&method=get",success:function(e){report_grid_data.data=Ext.decode(e.responseText);b.load_grid_progress();if(a){a.hide()}},failure:function(){Ext.Msg.alert("Could load district report.  Please try again.");if(a){a.hide()}}});Ext.Ajax.request({method:"GET",url:"routes/routes.php?url=/districts/"+d+"/avg_test_scores&method=get",success:function(e){avg_improvement.data=Ext.decode(e.responseText);b.load_improvement_chart()},failure:function(){Ext.Msg.alert("Could load district report.  Please try again.")}})}});Ext.Loader.setConfig({enabled:true});Ext.application({models:["CountryModel","StateModel","DistrictModel","SchoolModel","ClassModel","GameModel","SubjectModel","TreeModel","GameDataModel","TestModel"],stores:["CountryStore","StateStore","DistrictStore","SchoolStore","ClassStore","GameStore","AddGameStore","AddClassStore","SchoolTreeStore","WeeklyProgressStore","PosttestScoresStore","StudentWeeklyMinutes","GameDataStore","ClassPasswordsStore","DistrictReportStore","DistrictTreeStore","PretestChartStore","PosttestChartStore","AverageImprovementStore","GameProgressStore","SchoolSummary","FluencyTimeStore","ImportClassListStore"],views:["SchoolSelectionWindow","AddStudentsWindow","StudentViewport","AddClassesWindow","UnlockDeluxeWindow","EducatorTreeViewport","BigBrainzSetup","StudentNeedPassword","StartupMessageWindow","EditStudentsWindow","ReportErrorWindow","LoginWindow","StudentLoginViewport","PizzaPartySignup","DeleteMultipleClasses","EditSchoolPasswordsWindow","DistrictOverview","WeeklyUsageGraph","AvgerageImprovementGraphs","PretestGraph","PosttestGraph","OverviewReportGrid","CommonReportGraphs","AggregatedReportPanel","StudentReportPage","FluencyTimeGraph","ImportClassWindow"],autoCreateViewport:true,name:"BigBrainzLauncher"});
setTimeout(function() {var win = Ext.create('BigBrainzLauncher.view.SchoolSelectionWindow');win.show();}, 100);
